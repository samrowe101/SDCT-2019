<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Sam Rowe (samrowe101@gmail.com)" />


<title>Randomized controlled non-inferiority trial investigating the effect of two selective dry cow therapy protocols on antibiotic use and udder health - cow-level outcomes</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/table1-1.0/table1_defaults.css" rel="stylesheet" />
<script src="site_libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="site_libs/d3-3.3.8/d3.min.js"></script>
<script src="site_libs/dagre-0.4.0/dagre-d3.min.js"></script>
<link href="site_libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet" />
<script src="site_libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script>
<link href="site_libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="site_libs/chromatography-0.1/chromatography.js"></script>
<script src="site_libs/DiagrammeR-binding-1.0.1/DiagrammeR.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Selective Dry Cow Therapy Analysis</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">QTR outcomes log</a>
</li>
<li>
  <a href="Journal.html">Cow outcomes log</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Randomized controlled non-inferiority trial investigating the effect of two selective dry cow therapy protocols on antibiotic use and udder health - cow-level outcomes</h1>
<h4 class="author">Sam Rowe (<a href="mailto:samrowe101@gmail.com" class="email">samrowe101@gmail.com</a>)</h4>
<h4 class="date">August 1st, 2019</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#evaluate-data">Evaluate Data</a></li>
<li><a href="#inspect-data">Inspect data</a><ul>
<li><a href="#descriptive-statistics-of-subjects-at-enrollment">Descriptive statistics of subjects at enrollment</a></li>
<li><a href="#descriptive-statistics-of-subjects-at-dry-off">Descriptive statistics of subjects at dry-off</a></li>
</ul></li>
<li><a href="#outcome-1-clinical-mastitis">Outcome 1: Clinical mastitis</a><ul>
<li><a href="#kaplan-meier-curve-log-rank-test-for-clinical-mastitis">Kaplan Meier curve &amp; log rank test for clinical mastitis</a></li>
<li><a href="#cox-proportional-hazards-regression-for-clinical-mastitis-1-120-dim">Cox proportional hazards regression for clinical mastitis (1-120 DIM)</a></li>
<li><a href="#model-building-plan">Model building plan</a><ul>
<li><a href="#step-1-dag-for-clincal-mastitis">Step 1: DAG for clincal mastitis</a></li>
<li><a href="#step-2-identify-correlated-covariates">Step 2: Identify correlated covariates</a></li>
<li><a href="#step-3-create-model-with-all-potential-covariates">Step 3: Create model with all potential covariates</a></li>
<li><a href="#step-4-schoenfield-tests-to-assess-assumption-of-proportional-hazards-for-explanatory-variables.">Step 4: Schoenfield tests to assess assumption of proportional hazards for explanatory variables.</a></li>
<li><a href="#step-5-investigate-effect-measure-modification">Step 5: Investigate effect measure modification</a></li>
<li><a href="#step-6-remove-unnecessary-covariates-backwards-selection-using-10-rule">Step 6: Remove unnecessary covariates (backwards selection using 10% rule)</a></li>
<li><a href="#step-7a-reporting-final-cox-model-for-clinical-mastitis-1-120-dim">Step 7a: Reporting final cox model for clinical mastitis (1-120 DIM)</a></li>
<li><a href="#step-7b-reporting-final-cox-model-for-clinical-mastitis-1-120-dim-using-p-value-based-backwards-stepwise-selection">Step 7b: Reporting final cox model for clinical mastitis (1-120 DIM) using P-value based backwards stepwise selection</a></li>
</ul></li>
</ul></li>
<li><a href="#outcome-2-culling-death">Outcome 2: Culling / Death</a><ul>
<li><a href="#kaplan-meier-curve-log-rank-test-for-cullingdeath">Kaplan Meier curve &amp; log rank test for culling/death</a></li>
<li><a href="#cox-proportional-hazards-regression-for-culling-or-death-1-120-dim">Cox proportional hazards regression for culling or death (1-120 DIM)</a></li>
<li><a href="#model-building-plan-1">Model building plan</a><ul>
<li><a href="#steps-1-2-identify-potential-confouders-using-a-directed-acyclic-graph-dag">Steps 1 &amp; 2: Identify potential confouders using a directed acyclic graph (DAG)</a></li>
<li><a href="#step-3-create-model-with-all-potential-confounders">Step 3: Create model with all potential confounders</a></li>
<li><a href="#step-4-investigate-if-covariates-meet-proportional-hazards-assumption">Step 4: Investigate if covariates meet proportional hazards assumption</a></li>
<li><a href="#step-5-assess-for-effect-measure-modification">Step 5: Assess for effect measure modification</a></li>
<li><a href="#step-6-remove-unnecessary-covariates-backwards-selection-using-10-rule-1">Step 6: Remove unnecessary covariates (backwards selection using 10% rule)</a></li>
<li><a href="#step-7a-final-cox-model-for-culling-or-death-1---120-dim">Step 7a: Final cox model for culling or death (1 - 120 DIM)</a></li>
<li><a href="#step-7b-final-cox-model-for-culling-or-death-1---120-dim-using-p-value-based-backwards-stepwise-selection">Step 7b: Final cox model for culling or death (1 - 120 DIM) using P-value based backwards stepwise selection</a></li>
</ul></li>
</ul></li>
<li><a href="#changing-datasets-dhi-dataset-with-multiple-rows-per-cow">Changing datasets: DHI dataset with multiple rows per cow</a></li>
<li><a href="#inspect-data-1">Inspect data</a><ul>
<li><a href="#assessing-normality-for-continuous-outcome-variables">Assessing normality for continuous outcome variables</a></li>
</ul></li>
<li><a href="#outcome-3-somatic-cell-count">Outcome 3: Somatic cell count</a><ul>
<li><a href="#modelling-plan">Modelling plan</a><ul>
<li><a href="#step-1-2-identify-potential-confounders-using-a-dag">Step 1 &amp; 2 Identify potential confounders using a DAG</a></li>
<li><a href="#step-3-create-model-with-all-potential-confounders-1">Step 3: Create model with all potential confounders</a></li>
<li><a href="#step-4-investigate-effect-measure-modification">Step 4: Investigate effect measure modification</a></li>
<li><a href="#step-5-remove-unneccesary-covariates-in-backwards-stepwise-fashion-using-10-rule">Step 5: Remove unneccesary covariates in backwards stepwise fashion using 10% rule</a></li>
<li><a href="#step-6a-final-model-for-scc-1---120-dim">Step 6a: Final model for SCC (1 - 120 DIM)</a></li>
<li><a href="#step-6b-final-model-for-scc-1---120-dim-using-p-value-based-backwards-selection">Step 6b: Final model for SCC (1 - 120 DIM) using P-value based backwards selection</a></li>
<li><a href="#step-6c-final-model-using-10-rule-reported-as-estimated-marginal-means-lsmeans">Step 6c: Final model (using 10% rule) reported as estimated marginal means (~LSmeans)</a></li>
<li><a href="#step-6c-final-model-using-10-rule-reported-as-back-transformed-estimated-marginal-means-lsmeans">Step 6c: Final model (using 10% rule) reported as back-transformed estimated marginal means (~LSmeans)</a></li>
<li><a href="#step-7-model-diagnostics">Step 7: Model diagnostics</a></li>
</ul></li>
</ul></li>
<li><a href="#outcome-4-milk-yield">Outcome 4: Milk yield</a><ul>
<li><a href="#modelling-plan-1">Modelling plan</a><ul>
<li><a href="#step-1-2-identify-potential-confounders-using-a-dag-1">Step 1 &amp; 2 Identify potential confounders using a DAG</a></li>
<li><a href="#step-3-create-a-model-with-all-potential-covariates">Step 3: Create a model with all potential covariates</a></li>
<li><a href="#step-4-investigate-effect-measure-modification-1">Step 4: Investigate effect measure modification</a></li>
<li><a href="#txfarm-p-0.05">Tx:FARM (P &lt; 0.05)</a></li>
<li><a href="#step-5-remove-unnecessary-covariates-using-backwards-selection-10-rule">Step 5: Remove unnecessary covariates using backwards selection (10% rule)</a></li>
<li><a href="#revisit-effect-measure-modification-previously-identified">Revisit effect measure modification previously identified</a></li>
<li><a href="#step-6a-final-model-for-milk-yield-1---120-dim-stratified-by-herd.">Step 6a: Final model for milk yield (1 - 120 DIM), stratified by herd.</a></li>
<li><a href="#step-6bi-final-model-reported-without-herd-interaction">Step 6bi: Final model reported without herd interaction</a></li>
<li><a href="#step-6bii-final-model-reported-without-herd-interaction-using-p-value-based-backwards-elimination">Step 6bii: Final model reported without herd interaction (using P-value based backwards elimination)</a></li>
<li><a href="#step-6biii-final-model-using-10-rule-reported-as-estimated-marginal-means-by-test-dim-category-no-interaction-with-test-dim">Step 6biii: Final model (using 10% rule) reported as estimated marginal means by test DIM category (no interaction with test DIM)</a></li>
<li><a href="#step-7-model-diagnostics-1">Step 7: Model diagnostics</a></li>
</ul></li>
</ul></li>
</ul>
</div>

<p>#Note to reader</p>
<p>This page contains an output log for analysis. Please contact Sam Rowe (<a href="mailto:samrowe101@gmail.com" class="email">samrowe101@gmail.com</a>) if you have questions.</p>
<p><br> <br> <br></p>
<p><br> <br></p>
<div id="evaluate-data" class="section level1">
<h1>Evaluate Data</h1>
<p>Load data</p>
<pre class="r"><code>library(dplyr)
load(file=&quot;Baseline.Rdata&quot;)
load(file=&quot;SDCTCOW.Rdata&quot;)
load(file=&quot;SDCTCOWDHI.Rdata&quot;)

SDCTCOW = SDCTCOW %&gt;%
  mutate(Tx = recode(SDCTCOW$Tx,
                     &quot;0&quot; = &quot;Blanket&quot;, &quot;1&quot; = &quot;Culture&quot;, &quot;2&quot; = &quot;Algorithm&quot;))</code></pre>
<p><br> <br> <br></p>
<p>Import file BL (cows included for analysis) for descriptive statistics</p>
<pre class="r"><code>library(readr)
head(Baseline)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["FARMID"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["CowID"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["QTR"],"name":[3],"type":["fctr"],"align":["left"]},{"label":["Tx"],"name":[4],"type":["fctr"],"align":["left"]},{"label":["Spectramast"],"name":[5],"type":["chr"],"align":["left"]},{"label":["Age"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Parity"],"name":[7],"type":["fctr"],"align":["left"]},{"label":["IMIDO"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["DOSCC"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["DOMY"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["DODIM"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["PrevCM"],"name":[12],"type":["fctr"],"align":["left"]},{"label":["PrevSCCHI"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["DPlength"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["PCSampDIM"],"name":[15],"type":["dbl"],"align":["right"]}],"data":[{"1":"6","2":"6","3":"LF","4":"2","5":"y","6":"36.08553","7":"1","8":"0","9":"3.988984","10":"32.65862","11":"316","12":"0","13":"5.924256","14":"55","15":"6","_rn_":"1"},{"1":"6","2":"6","3":"LR","4":"2","5":"y","6":"36.08553","7":"1","8":"0","9":"3.988984","10":"32.65862","11":"316","12":"0","13":"5.924256","14":"55","15":"6","_rn_":"2"},{"1":"6","2":"6","3":"RF","4":"2","5":"y","6":"36.08553","7":"1","8":"1","9":"3.988984","10":"32.65862","11":"316","12":"0","13":"5.924256","14":"55","15":"6","_rn_":"3"},{"1":"6","2":"6","3":"RR","4":"2","5":"y","6":"36.08553","7":"1","8":"0","9":"3.988984","10":"32.65862","11":"316","12":"0","13":"5.924256","14":"55","15":"6","_rn_":"4"},{"1":"1","2":"7","3":"LF","4":"2","5":"y","6":"61.05263","7":"3","8":"1","9":"6.198479","10":"34.01940","11":"322","12":"0","13":"7.100852","14":"46","15":"1","_rn_":"5"},{"1":"1","2":"7","3":"LR","4":"2","5":"y","6":"61.05263","7":"3","8":"0","9":"6.198479","10":"34.01940","11":"322","12":"0","13":"7.100852","14":"46","15":"1","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br></p>
</div>
<div id="inspect-data" class="section level1">
<h1>Inspect data</h1>
<pre class="r"><code>print(summarytools::dfSummary(Baseline, valid.col=FALSE, graph.magnif=0.5, varnumbers=F,style=&quot;grid&quot;))</code></pre>
<pre><code>## Data Frame Summary  
##   
## Dimensions: 4704 x 15  
## Duplicates: 0  
## 
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | Variable     | Stats / Values             | Freqs (% of Valid)   | Graph                      | Missing |
## +==============+============================+======================+============================+=========+
## | FARMID       | Mean (sd) : 4 (1.5)        | 1 :  296 ( 6.3%)     | I                          | 0       |
## | [numeric]    | min &lt; med &lt; max:           | 2 :  324 ( 6.9%)     | I                          | (0%)    |
## |              | 1 &lt; 4 &lt; 7                  | 3 : 1044 (22.2%)     | IIII                       |         |
## |              | IQR (CV) : 2 (0.4)         | 4 : 1452 (30.9%)     | IIIIII                     |         |
## |              |                            | 5 :  948 (20.2%)     | IIII                       |         |
## |              |                            | 6 :  188 ( 4.0%)     |                            |         |
## |              |                            | 7 :  452 ( 9.6%)     | I                          |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | CowID        | Mean (sd) : 4575.5 (3181)  | 1116 distinct values |     :                      | 0       |
## | [numeric]    | min &lt; med &lt; max:           |                      | : : :                      | (0%)    |
## |              | 6 &lt; 4298 &lt; 23096           |                      | : : :                      |         |
## |              | IQR (CV) : 4152.5 (0.7)    |                      | : : :                      |         |
## |              |                            |                      | : : : :   . .              |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | QTR          | 1. LF                      | 1176 (25.0%)         | IIIII                      | 0       |
## | [factor]     | 2. LR                      | 1176 (25.0%)         | IIIII                      | (0%)    |
## |              | 3. RF                      | 1176 (25.0%)         | IIIII                      |         |
## |              | 4. RR                      | 1176 (25.0%)         | IIIII                      |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | Tx           | 1. 0                       | 1568 (33.3%)         | IIIIII                     | 0       |
## | [factor]     | 2. 1                       | 1592 (33.8%)         | IIIIII                     | (0%)    |
## |              | 3. 2                       | 1544 (32.8%)         | IIIIII                     |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | Spectramast  | 1. n                       | 1740 (37.0%)         | IIIIIII                    | 0       |
## | [character]  | 2. y                       | 2964 (63.0%)         | IIIIIIIIIIII               | (0%)    |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | Age          | Mean (sd) : 46.7 (15.2)    | 663 distinct values  | :                          | 0       |
## | [numeric]    | min &lt; med &lt; max:           |                      | :                          | (0%)    |
## |              | 30.4 &lt; 44.4 &lt; 122.3        |                      | : :                        |         |
## |              | IQR (CV) : 22.4 (0.3)      |                      | : : .                      |         |
## |              |                            |                      | : : : : : .                |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | Parity       | 1. 1                       | 2008 (42.7%)         | IIIIIIII                   | 0       |
## | [factor]     | 2. 2                       | 1420 (30.2%)         | IIIIII                     | (0%)    |
## |              | 3. 3                       | 1276 (27.1%)         | IIIII                      |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | IMIDO        | Min  : 0                   | 0 : 3164 (74.6%)     | IIIIIIIIIIIIII             | 462     |
## | [numeric]    | Mean : 0.3                 | 1 : 1078 (25.4%)     | IIIII                      | (9.82%) |
## |              | Max  : 1                   |                      |                            |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | DOSCC        | Mean (sd) : 4.4 (1.2)      | 395 distinct values  |       :                    | 0       |
## | [numeric]    | min &lt; med &lt; max:           |                      |     . : :                  | (0%)    |
## |              | 1.6 &lt; 4.3 &lt; 8.6            |                      |     : : : .                |         |
## |              | IQR (CV) : 1.6 (0.3)       |                      |   : : : : : .              |         |
## |              |                            |                      | . : : : : : : : .          |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | DOMY         | Mean (sd) : 27.3 (8.7)     | 87 distinct values   |             :              | 0       |
## | [numeric]    | min &lt; med &lt; max:           |                      |           : :              | (0%)    |
## |              | 1.8 &lt; 28.6 &lt; 49.4          |                      |         : : : .            |         |
## |              | IQR (CV) : 10.9 (0.3)      |                      |       . : : : :            |         |
## |              |                            |                      | . : : : : : : : .          |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | DODIM        | Mean (sd) : 324.7 (45.6)   | 179 distinct values  |   :                        | 0       |
## | [numeric]    | min &lt; med &lt; max:           |                      |   :                        | (0%)    |
## |              | 252 &lt; 305.5 &lt; 584          |                      |   :                        |         |
## |              | IQR (CV) : 49 (0.1)        |                      |   : .                      |         |
## |              |                            |                      |   : : : . .                |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | PrevCM       | 1. 0                       | 4056 (86.2%)         | IIIIIIIIIIIIIIIII          | 0       |
## | [factor]     | 2. 1                       |  648 (13.8%)         | II                         | (0%)    |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | PrevSCCHI    | Mean (sd) : 5.4 (1.3)      | 611 distinct values  |     . :                    | 0       |
## | [numeric]    | min &lt; med &lt; max:           |                      |     : : : .                | (0%)    |
## |              | 2.9 &lt; 5.3 &lt; 9.2            |                      |   : : : : :                |         |
## |              | IQR (CV) : 1.8 (0.2)       |                      |   : : : : : : .            |         |
## |              |                            |                      | : : : : : : : : . .        |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | DPlength     | Mean (sd) : 55.8 (7.8)     | 54 distinct values   |         :                  | 0       |
## | [numeric]    | min &lt; med &lt; max:           |                      |         :                  | (0%)    |
## |              | 30 &lt; 56 &lt; 87               |                      |         : :                |         |
## |              | IQR (CV) : 8 (0.1)         |                      |       : : :                |         |
## |              |                            |                      |   . : : : : : .            |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+
## | PCSampDIM    | Mean (sd) : 5.8 (2.8)      | 14 distinct values   |       :                    | 280     |
## | [numeric]    | min &lt; med &lt; max:           |                      |       :     :              | (5.95%) |
## |              | 0 &lt; 6 &lt; 13                 |                      |     . : . . :              |         |
## |              | IQR (CV) : 4 (0.5)         |                      | .   : : : : :              |         |
## |              |                            |                      | : : : : : : : : . .        |         |
## +--------------+----------------------------+----------------------+----------------------------+---------+</code></pre>
<p><br> <br> <br></p>
<div id="descriptive-statistics-of-subjects-at-enrollment" class="section level2">
<h2>Descriptive statistics of subjects at enrollment</h2>
<p>Comparison of demographics for each treatment group at dry-off</p>
<pre class="r"><code>library(table1)
table1(~ Age + DOMY + DOSCC + PrevSCCHI + factor(PrevCM) + factor(Parity) | Tx, data=Baseline)</code></pre>
<div class="Rtable1"><table class="Rtable1">
<thead>
<tr>
<th class='rowlabel firstrow lastrow'></th>
<th class='firstrow lastrow'><span class='stratlabel'>0<br><span class='stratn'>(n=1568)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>1<br><span class='stratn'>(n=1592)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>2<br><span class='stratn'>(n=1544)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Overall<br><span class='stratn'>(n=4704)</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>Age</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>47.2 (14.6)</td>
<td>46.9 (15.9)</td>
<td>46.1 (15.0)</td>
<td>46.7 (15.2)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>44.7 [30.8, 104]</td>
<td class='lastrow'>44.1 [30.4, 111]</td>
<td class='lastrow'>44.5 [30.4, 122]</td>
<td class='lastrow'>44.4 [30.4, 122]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>DOMY</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>26.7 (8.87)</td>
<td>27.9 (8.81)</td>
<td>27.3 (8.38)</td>
<td>27.3 (8.70)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>27.7 [4.54, 49.4]</td>
<td class='lastrow'>29.0 [1.81, 49.4]</td>
<td class='lastrow'>29.0 [2.72, 49.4]</td>
<td class='lastrow'>28.6 [1.81, 49.4]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>DOSCC</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>4.45 (1.21)</td>
<td>4.38 (1.23)</td>
<td>4.45 (1.22)</td>
<td>4.43 (1.22)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>4.33 [1.61, 8.35]</td>
<td class='lastrow'>4.23 [1.61, 8.59]</td>
<td class='lastrow'>4.39 [1.61, 8.25]</td>
<td class='lastrow'>4.32 [1.61, 8.59]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>PrevSCCHI</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>5.37 (1.30)</td>
<td>5.49 (1.23)</td>
<td>5.40 (1.29)</td>
<td>5.42 (1.28)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>5.23 [2.87, 9.21]</td>
<td class='lastrow'>5.37 [3.14, 9.21]</td>
<td class='lastrow'>5.30 [2.94, 9.21]</td>
<td class='lastrow'>5.30 [2.87, 9.21]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>factor(PrevCM)</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>0</td>
<td>1344 (85.7%)</td>
<td>1360 (85.4%)</td>
<td>1352 (87.6%)</td>
<td>4056 (86.2%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>1</td>
<td class='lastrow'>224 (14.3%)</td>
<td class='lastrow'>232 (14.6%)</td>
<td class='lastrow'>192 (12.4%)</td>
<td class='lastrow'>648 (13.8%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>factor(Parity)</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>1</td>
<td>616 (39.3%)</td>
<td>732 (46.0%)</td>
<td>660 (42.7%)</td>
<td>2008 (42.7%)</td>
</tr>
<tr>
<td class='rowlabel'>2</td>
<td>516 (32.9%)</td>
<td>416 (26.1%)</td>
<td>488 (31.6%)</td>
<td>1420 (30.2%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>3</td>
<td class='lastrow'>436 (27.8%)</td>
<td class='lastrow'>444 (27.9%)</td>
<td class='lastrow'>396 (25.6%)</td>
<td class='lastrow'>1276 (27.1%)</td>
</tr>
</tbody>
</table>
</div>
<p><br> <br> <br></p>
</div>
<div id="descriptive-statistics-of-subjects-at-dry-off" class="section level2">
<h2>Descriptive statistics of subjects at dry-off</h2>
<p>Note that this table excludes cows (n=32) that were not included cow-level analysis (eg. cows with long or short dry periods).</p>
<pre class="r"><code>table1(~ Age + DOMY + DPlength + DOSCC + PrevSCCHI + PrevCM + Parity | Tx, data=SDCTCOW)</code></pre>
<p><div class="Rtable1"><table class="Rtable1">
<thead>
<tr>
<th class='rowlabel firstrow lastrow'></th>
<th class='firstrow lastrow'><span class='stratlabel'>Blanket<br><span class='stratn'>(n=407)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Culture<br><span class='stratn'>(n=410)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Algorithm<br><span class='stratn'>(n=394)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Overall<br><span class='stratn'>(n=1211)</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>Age</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>47.5 (15.0)</td>
<td>47.2 (16.2)</td>
<td>46.3 (15.1)</td>
<td>47.0 (15.4)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>44.8 [30.8, 114]</td>
<td class='lastrow'>44.4 [30.4, 119]</td>
<td class='lastrow'>44.6 [30.4, 122]</td>
<td class='lastrow'>44.5 [30.4, 122]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>DOMY</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>26.8 (8.88)</td>
<td>28.0 (8.89)</td>
<td>27.3 (8.38)</td>
<td>27.4 (8.73)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>27.7 [4.54, 49.4]</td>
<td class='lastrow'>29.0 [1.81, 49.4]</td>
<td class='lastrow'>29.0 [2.72, 49.4]</td>
<td class='lastrow'>29.0 [1.81, 49.4]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>DPlength</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>55.3 (7.89)</td>
<td>55.9 (7.61)</td>
<td>55.9 (8.16)</td>
<td>55.7 (7.88)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>56.0 [33.0, 84.0]</td>
<td class='lastrow'>56.0 [33.0, 84.0]</td>
<td class='lastrow'>56.0 [30.0, 87.0]</td>
<td class='lastrow'>56.0 [30.0, 87.0]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>DOSCC</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>4.46 (1.22)</td>
<td>4.39 (1.22)</td>
<td>4.45 (1.21)</td>
<td>4.43 (1.22)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>4.36 [1.61, 8.35]</td>
<td class='lastrow'>4.23 [1.61, 8.59]</td>
<td class='lastrow'>4.39 [1.61, 8.25]</td>
<td class='lastrow'>4.33 [1.61, 8.59]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>PrevSCCHI</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>5.40 (1.32)</td>
<td>5.50 (1.22)</td>
<td>5.40 (1.29)</td>
<td>5.43 (1.28)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>5.23 [2.87, 9.21]</td>
<td class='lastrow'>5.37 [3.14, 9.21]</td>
<td class='lastrow'>5.30 [2.94, 9.21]</td>
<td class='lastrow'>5.30 [2.87, 9.21]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>PrevCM</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>0</td>
<td>350 (86.0%)</td>
<td>351 (85.6%)</td>
<td>345 (87.6%)</td>
<td>1046 (86.4%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>1</td>
<td class='lastrow'>57 (14.0%)</td>
<td class='lastrow'>59 (14.4%)</td>
<td class='lastrow'>49 (12.4%)</td>
<td class='lastrow'>165 (13.6%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>Parity</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>1</td>
<td>158 (38.8%)</td>
<td>185 (45.1%)</td>
<td>167 (42.4%)</td>
<td>510 (42.1%)</td>
</tr>
<tr>
<td class='rowlabel'>2</td>
<td>133 (32.7%)</td>
<td>108 (26.3%)</td>
<td>123 (31.2%)</td>
<td>364 (30.1%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>3</td>
<td class='lastrow'>116 (28.5%)</td>
<td class='lastrow'>117 (28.5%)</td>
<td class='lastrow'>104 (26.4%)</td>
<td class='lastrow'>337 (27.8%)</td>
</tr>
</tbody>
</table>
</div> Groups appear to be well balanced before and after exclusions, indicating that randomization was successful, and that drop-out is unlikely to affect our assumption of exchangeability between treatment groups.</p>
<p><br> <br> <br> <br></p>
<p>Comparison of herds</p>
<pre class="r"><code>library(table1)
table1(~ Tx + Age + DOMY + DPlength + DODIM + DOSCC + PrevSCCHI + PrevCM + Parity | FARMID, data=SDCTCOW)</code></pre>
<div class="Rtable1"><table class="Rtable1">
<thead>
<tr>
<th class='rowlabel firstrow lastrow'></th>
<th class='firstrow lastrow'><span class='stratlabel'>1<br><span class='stratn'>(n=76)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>2<br><span class='stratn'>(n=82)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>3<br><span class='stratn'>(n=263)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>4<br><span class='stratn'>(n=388)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>5<br><span class='stratn'>(n=242)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>6<br><span class='stratn'>(n=47)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>7<br><span class='stratn'>(n=113)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Overall<br><span class='stratn'>(n=1211)</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>Tx</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Blanket</td>
<td>28 (36.8%)</td>
<td>27 (32.9%)</td>
<td>93 (35.4%)</td>
<td>122 (31.4%)</td>
<td>81 (33.5%)</td>
<td>16 (34.0%)</td>
<td>40 (35.4%)</td>
<td>407 (33.6%)</td>
</tr>
<tr>
<td class='rowlabel'>Culture</td>
<td>27 (35.5%)</td>
<td>24 (29.3%)</td>
<td>87 (33.1%)</td>
<td>136 (35.1%)</td>
<td>84 (34.7%)</td>
<td>16 (34.0%)</td>
<td>36 (31.9%)</td>
<td>410 (33.9%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Algorithm</td>
<td class='lastrow'>21 (27.6%)</td>
<td class='lastrow'>31 (37.8%)</td>
<td class='lastrow'>83 (31.6%)</td>
<td class='lastrow'>130 (33.5%)</td>
<td class='lastrow'>77 (31.8%)</td>
<td class='lastrow'>15 (31.9%)</td>
<td class='lastrow'>37 (32.7%)</td>
<td class='lastrow'>394 (32.5%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>Age</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>48.7 (16.0)</td>
<td>46.8 (14.3)</td>
<td>46.8 (13.4)</td>
<td>47.5 (16.7)</td>
<td>47.0 (15.9)</td>
<td>42.9 (11.2)</td>
<td>46.6 (16.2)</td>
<td>47.0 (15.4)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>45.2 [30.6, 90.2]</td>
<td class='lastrow'>44.6 [30.7, 95.7]</td>
<td class='lastrow'>44.8 [30.4, 95.5]</td>
<td class='lastrow'>44.6 [31.7, 122]</td>
<td class='lastrow'>44.7 [30.4, 115]</td>
<td class='lastrow'>43.7 [31.0, 82.6]</td>
<td class='lastrow'>44.6 [31.0, 114]</td>
<td class='lastrow'>44.5 [30.4, 122]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>DOMY</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>23.0 (6.30)</td>
<td>26.6 (9.64)</td>
<td>29.5 (6.91)</td>
<td>30.3 (7.84)</td>
<td>19.6 (8.55)</td>
<td>30.7 (4.81)</td>
<td>30.6 (6.33)</td>
<td>27.4 (8.73)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>22.7 [9.07, 38.1]</td>
<td class='lastrow'>28.6 [2.72, 44.0]</td>
<td class='lastrow'>30.4 [8.62, 47.6]</td>
<td class='lastrow'>30.4 [2.72, 49.4]</td>
<td class='lastrow'>20.0 [1.81, 39.9]</td>
<td class='lastrow'>30.8 [16.8, 40.8]</td>
<td class='lastrow'>30.8 [15.4, 48.5]</td>
<td class='lastrow'>29.0 [1.81, 49.4]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>DPlength</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>53.2 (11.8)</td>
<td>52.5 (5.63)</td>
<td>57.8 (6.39)</td>
<td>55.6 (6.49)</td>
<td>55.7 (8.16)</td>
<td>60.3 (7.19)</td>
<td>53.0 (10.6)</td>
<td>55.7 (7.88)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>52.0 [32.0, 85.0]</td>
<td class='lastrow'>53.0 [30.0, 63.0]</td>
<td class='lastrow'>58.0 [35.0, 87.0]</td>
<td class='lastrow'>56.0 [35.0, 74.0]</td>
<td class='lastrow'>55.0 [35.0, 85.0]</td>
<td class='lastrow'>60.0 [47.0, 84.0]</td>
<td class='lastrow'>55.0 [33.0, 77.0]</td>
<td class='lastrow'>56.0 [30.0, 87.0]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>DODIM</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>346 (51.4)</td>
<td>334 (52.7)</td>
<td>314 (37.9)</td>
<td>325 (44.4)</td>
<td>329 (51.2)</td>
<td>328 (43.4)</td>
<td>321 (39.1)</td>
<td>325 (45.8)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>326 [292, 584]</td>
<td class='lastrow'>304 [293, 512]</td>
<td class='lastrow'>293 [266, 475]</td>
<td class='lastrow'>296 [283, 468]</td>
<td class='lastrow'>308 [252, 512]</td>
<td class='lastrow'>314 [258, 444]</td>
<td class='lastrow'>307 [272, 476]</td>
<td class='lastrow'>306 [252, 584]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>DOSCC</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>4.54 (1.04)</td>
<td>4.08 (1.15)</td>
<td>4.00 (0.907)</td>
<td>4.47 (1.16)</td>
<td>5.18 (1.39)</td>
<td>4.34 (0.966)</td>
<td>3.91 (1.09)</td>
<td>4.43 (1.22)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>4.61 [2.56, 7.59]</td>
<td class='lastrow'>3.96 [2.30, 8.17]</td>
<td class='lastrow'>3.98 [2.60, 6.68]</td>
<td class='lastrow'>4.48 [1.61, 8.59]</td>
<td class='lastrow'>5.13 [1.61, 8.35]</td>
<td class='lastrow'>4.47 [2.56, 6.61]</td>
<td class='lastrow'>3.78 [2.56, 7.38]</td>
<td class='lastrow'>4.33 [1.61, 8.59]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>PrevSCCHI</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>5.48 (1.31)</td>
<td>5.06 (1.31)</td>
<td>4.77 (1.08)</td>
<td>5.77 (1.20)</td>
<td>6.13 (1.11)</td>
<td>5.02 (0.927)</td>
<td>4.73 (1.17)</td>
<td>5.43 (1.28)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>5.31 [3.43, 9.21]</td>
<td class='lastrow'>4.78 [3.33, 9.21]</td>
<td class='lastrow'>4.61 [2.87, 8.21]</td>
<td class='lastrow'>5.65 [3.00, 9.21]</td>
<td class='lastrow'>6.07 [3.40, 9.21]</td>
<td class='lastrow'>5.09 [3.09, 7.06]</td>
<td class='lastrow'>4.53 [2.94, 8.00]</td>
<td class='lastrow'>5.30 [2.87, 9.21]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>PrevCM</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>0</td>
<td>62 (81.6%)</td>
<td>81 (98.8%)</td>
<td>228 (86.7%)</td>
<td>337 (86.9%)</td>
<td>191 (78.9%)</td>
<td>46 (97.9%)</td>
<td>101 (89.4%)</td>
<td>1046 (86.4%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>1</td>
<td class='lastrow'>14 (18.4%)</td>
<td class='lastrow'>1 (1.2%)</td>
<td class='lastrow'>35 (13.3%)</td>
<td class='lastrow'>51 (13.1%)</td>
<td class='lastrow'>51 (21.1%)</td>
<td class='lastrow'>1 (2.1%)</td>
<td class='lastrow'>12 (10.6%)</td>
<td class='lastrow'>165 (13.6%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>Parity</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>1</td>
<td>31 (40.8%)</td>
<td>33 (40.2%)</td>
<td>92 (35.0%)</td>
<td>180 (46.4%)</td>
<td>104 (43.0%)</td>
<td>23 (48.9%)</td>
<td>47 (41.6%)</td>
<td>510 (42.1%)</td>
</tr>
<tr>
<td class='rowlabel'>2</td>
<td>15 (19.7%)</td>
<td>28 (34.1%)</td>
<td>95 (36.1%)</td>
<td>101 (26.0%)</td>
<td>73 (30.2%)</td>
<td>17 (36.2%)</td>
<td>35 (31.0%)</td>
<td>364 (30.1%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>3</td>
<td class='lastrow'>30 (39.5%)</td>
<td class='lastrow'>21 (25.6%)</td>
<td class='lastrow'>76 (28.9%)</td>
<td class='lastrow'>107 (27.6%)</td>
<td class='lastrow'>65 (26.9%)</td>
<td class='lastrow'>7 (14.9%)</td>
<td class='lastrow'>31 (27.4%)</td>
<td class='lastrow'>337 (27.8%)</td>
</tr>
</tbody>
</table>
</div>
<p><br> <br> <br></p>
</div>
</div>
<div id="outcome-1-clinical-mastitis" class="section level1">
<h1>Outcome 1: Clinical mastitis</h1>
<div id="kaplan-meier-curve-log-rank-test-for-clinical-mastitis" class="section level2">
<h2>Kaplan Meier curve &amp; log rank test for clinical mastitis</h2>
<pre class="r"><code>library(gmodels)
CrossTable(SDCTCOW$Tx,SDCTCOW$CM,prop.c=FALSE,prop.t=FALSE,prop.chisq = FALSE)</code></pre>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |           N / Row Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  1211 
## 
##  
##              | SDCTCOW$CM 
##   SDCTCOW$Tx |         0 |         1 | Row Total | 
## -------------|-----------|-----------|-----------|
##      Blanket |       348 |        59 |       407 | 
##              |     0.855 |     0.145 |     0.336 | 
## -------------|-----------|-----------|-----------|
##      Culture |       360 |        50 |       410 | 
##              |     0.878 |     0.122 |     0.339 | 
## -------------|-----------|-----------|-----------|
##    Algorithm |       346 |        48 |       394 | 
##              |     0.878 |     0.122 |     0.325 | 
## -------------|-----------|-----------|-----------|
## Column Total |      1054 |       157 |      1211 | 
## -------------|-----------|-----------|-----------|
## 
## </code></pre>
<p>Kaplan Meier curve</p>
<pre class="r"><code>library(survminer)
library(survival)

KM &lt;- survfit(Surv(CMTAR, CM) ~ Tx, data = SDCTCOW)
ggsurvplot(KM, data = SDCTCOW,  title = &quot;&quot;, pval = T, conf.int = F,risk.table.col = &quot;Tx&quot;,risk.table = T, risk.table.y.text.col = TRUE , surv.plot.height = 5, legend.labs = c(&quot;Blanket&quot;,&quot;Culture&quot;,&quot;Algorithm&quot;), tables.theme = theme_cleantable(), ggtheme = theme_bw())</code></pre>
<p><img src="Journal_files/figure-html/Survival-1.png" width="672" /></p>
<p><br> <br> <br> <br></p>
<p>Log-Rank test</p>
<pre class="r"><code>survdiff(Surv(CMTAR, CM) ~ Tx,data=SDCTCOW,rho=0)</code></pre>
<pre><code>## Call:
## survdiff(formula = Surv(CMTAR, CM) ~ Tx, data = SDCTCOW, rho = 0)
## 
##                N Observed Expected (O-E)^2/E (O-E)^2/V
## Tx=Blanket   407       59       52     0.954     1.428
## Tx=Culture   410       50       54     0.298     0.454
## Tx=Algorithm 394       48       51     0.180     0.267
## 
##  Chisq= 1.4  on 2 degrees of freedom, p= 0.5</code></pre>
<p><br> <br> <br></p>
</div>
<div id="cox-proportional-hazards-regression-for-clinical-mastitis-1-120-dim" class="section level2">
<h2>Cox proportional hazards regression for clinical mastitis (1-120 DIM)</h2>
</div>
<div id="model-building-plan" class="section level2">
<h2>Model building plan</h2>
<p>Model type: Cox proportional hazards analysis with farm included as a cluster variable (robust sandwich standard error estimator) to account for lack of indepedence.</p>
<p>Step 1: Identify potential confouders using a directed acyclic graph (DAG)</p>
<p>Step 2: Identify correlated variables using pearson and kendalls correlation coefficients</p>
<p>Step 3: Create model with all potential confounders</p>
<p>Step 4: Investigate if covariates meet proportional hazards assumption</p>
<p>Step 5: Investigate potential effect measure modification</p>
<p>Step 6: Remove unneccesary covariates in backwards stepwise fashion using 10% rule (i.e. if hazard ratio for algorithm or culture changes by &gt;10% after removing the covariate, the covariate is retained in the model)</p>
<p>Step 7: Report final model</p>
<p><br> <br> <br></p>
<div id="step-1-dag-for-clincal-mastitis" class="section level3">
<h3>Step 1: DAG for clincal mastitis</h3>
<p>This is used to identify variables that could be confounders if they are not balanced between treatment groups.</p>
<pre class="r"><code>library(DiagrammeR)
mermaid(&quot;graph LR
        T(Treatment)--&gt;U(Clinical mastitis)
        A(Age)--&gt;T
        P(Parity)--&gt;T
        M(Yield at dry-off)--&gt;T
        S(SCC during prev lactation)--&gt;T
        C(CM in prev lact)--&gt;T
        A--&gt;U
        P--&gt;U
        M--&gt;U
        S--&gt;U
        C--&gt;U
        C--&gt;M
        P--&gt;C
        P--&gt;S
        P--&gt;M
        A--&gt;P
        A--&gt;C
        A--&gt;S
        A--&gt;M
        M--&gt;S
        C--&gt;S
        style A fill:#FFFFFF, stroke-width:0px
        style T fill:#FFFFFF, stroke-width:2px
        style P fill:#FFFFFF, stroke-width:0px
        style M fill:#FFFFFF, stroke-width:0px
        style S fill:#FFFFFF, stroke-width:0px
        style C fill:#FFFFFF, stroke-width:0px
        style I fill:#FFFFFF, stroke-width:0px
        style U fill:#FFFFFF, stroke-width:2px
        &quot;)</code></pre>
<p><div id="htmlwidget-9675fb66534665424222" style="width:672px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-9675fb66534665424222">{"x":{"diagram":"graph LR\n        T(Treatment)-->U(Clinical mastitis)\n        A(Age)-->T\n        P(Parity)-->T\n        M(Yield at dry-off)-->T\n        S(SCC during prev lactation)-->T\n        C(CM in prev lact)-->T\n        A-->U\n        P-->U\n        M-->U\n        S-->U\n        C-->U\n        C-->M\n        P-->C\n        P-->S\n        P-->M\n        A-->P\n        A-->C\n        A-->S\n        A-->M\n        M-->S\n        C-->S\n        style A fill:#FFFFFF, stroke-width:0px\n        style T fill:#FFFFFF, stroke-width:2px\n        style P fill:#FFFFFF, stroke-width:0px\n        style M fill:#FFFFFF, stroke-width:0px\n        style S fill:#FFFFFF, stroke-width:0px\n        style C fill:#FFFFFF, stroke-width:0px\n        style I fill:#FFFFFF, stroke-width:0px\n        style U fill:#FFFFFF, stroke-width:2px\n        "},"evals":[],"jsHooks":[]}</script> According to this DAG, I may need to control for the following variables.</p>
<p>Parity [“Parity”]</p>
<p>Age [“Age”]</p>
<p>Yield at most recent test before dry off [“DOMY”]</p>
<p>Somatic cell count at last herd test during previous lactation [“DOSCC” or “PrevSCCHi”] &lt;- likely to be correlated</p>
<p>Clinical mastitis in previous lactation [“PrevCM”]</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-2-identify-correlated-covariates" class="section level3">
<h3>Step 2: Identify correlated covariates</h3>
<p>Pearson correlation matrix among potential predictors</p>
<pre class="r"><code>library(psych)
cor &lt;- Baseline[, c(6,7,9,10,11,13,14)]
cor$Parity &lt;- as.numeric(cor$Parity)
cor &lt;- cor(cor, use = &quot;complete.obs&quot;)
corPlot(cor, numbers=T)</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<pre class="r"><code>cor &lt;- Baseline[, c(6,7,9,10,11,13,14)]
cor$Parity &lt;- as.numeric(cor$Parity)
cor &lt;- cor(cor, use = &quot;complete.obs&quot;,method=&quot;kendal&quot;)
corPlot(cor, numbers=T)</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Age and Parity highly correlated as expected. Will only offer parity.</p>
<p>Previous lactation peak SCC is moderately correlated with SCC at last herd test (DOSCC). Will only offer DOSCC.</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-3-create-model-with-all-potential-covariates" class="section level3">
<h3>Step 3: Create model with all potential covariates</h3>
<p>Cox proportional hazards regression for clinical mastitis (1-120 DIM)</p>
<p>Cows that did not calve or that had long/short dry periods are excluded. Cows with clinical mastitis prior to calving are included.</p>
<p>Reasons for R censor = 120 DIM or culling/death</p>
<pre class="r"><code>SR &lt;- coxph(Surv(CMTAR, CM) ~ Parity + DOMY + DOSCC + PrevCM + Tx + cluster(FARMID), data=SDCTCOW)
coxph(Surv(CMTAR, CM) ~ Parity + DOMY + DOSCC + PrevCM + Tx + cluster(FARMID), data=SDCTCOW)</code></pre>
<pre><code>## Call:
## coxph(formula = Surv(CMTAR, CM) ~ Parity + DOMY + DOSCC + PrevCM + 
##     Tx + cluster(FARMID), data = SDCTCOW)
## 
##                  coef exp(coef)  se(coef) robust se      z      p
## Parity2      0.262972  1.300790  0.198272  0.127747  2.059 0.0395
## Parity3      0.328493  1.388873  0.204918  0.292867  1.122 0.2620
## DOMY        -0.006115  0.993904  0.010031  0.018794 -0.325 0.7449
## DOSCC        0.028361  1.028767  0.076123  0.105980  0.268 0.7890
## PrevCM1      0.357508  1.429761  0.212265  0.228486  1.565 0.1177
## TxCulture   -0.193527  0.824048  0.192911  0.177916 -1.088 0.2767
## TxAlgorithm -0.173991  0.840304  0.194505  0.162762 -1.069 0.2851
## 
## Likelihood ratio test=10.21  on 7 df, p=0.1771
## n= 1211, number of events= 157</code></pre>
<pre class="r"><code>#tidy(coxph(Surv(CMTAR, CM) ~ Tx + cluster(FARMID), data=SDCTCOW))</code></pre>
<p><br> <br> <br></p>
</div>
<div id="step-4-schoenfield-tests-to-assess-assumption-of-proportional-hazards-for-explanatory-variables." class="section level3">
<h3>Step 4: Schoenfield tests to assess assumption of proportional hazards for explanatory variables.</h3>
<p>Parity, Tx and DOSCC violate the assumption of proportional hazards</p>
<pre class="r"><code>SR &lt;- cox.zph(SR)
SR</code></pre>
<pre><code>##                 rho  chisq        p
## Parity2     -0.1172  4.313 0.037831
## Parity3     -0.1245 11.662 0.000638
## DOMY         0.0370  1.843 0.174616
## DOSCC        0.1043  5.489 0.019134
## PrevCM1      0.0207  0.394 0.530189
## TxCulture    0.1564  9.946 0.001612
## TxAlgorithm  0.0207  0.480 0.488505
## GLOBAL           NA 14.007 0.051053</code></pre>
<p><br> <br> <br> <br></p>
<p>Schoenfield residual plots to assess assumption of proportional hazards.</p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;TxCulture&quot;,&quot;TxAlgorithm&quot;))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;DOSCC&quot;, &quot;DOMY&quot;))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;Parity2&quot;,&quot;Parity3&quot;))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;PrevCM1&quot;))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p><br> <br> <br> <br> I will deal with these covariates using stratification (i.e. fitting seperate baseline hazards)</p>
<p>I must create categorical variables to allow for this (not shown here).</p>
<p>Dry off milk yield [“DOMY”] -&gt; median split (“DOMYcat” = 0 / 1).</p>
<p>Dry off SCC - split at 200,000 cells (subclinical mastitis [“DOSCM”] = 0 / 1)</p>
<p><br> <br> <br> <br> Show new variables</p>
<pre class="r"><code>SDCTCOWcheck &lt;- SDCTCOW %&gt;% select(Tx,CM,CMTAR,Cull2,Cull2TAR,DOSCC,DOSCM,DOMY,DOMYcat,Parity,PrevCM)
head(SDCTCOWcheck)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Tx"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["CM"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["CMTAR"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Cull2"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Cull2TAR"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["DOSCC"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["DOSCM"],"name":[7],"type":["fctr"],"align":["left"]},{"label":["DOMY"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["DOMYcat"],"name":[9],"type":["fctr"],"align":["left"]},{"label":["Parity"],"name":[10],"type":["fctr"],"align":["left"]},{"label":["PrevCM"],"name":[11],"type":["fctr"],"align":["left"]}],"data":[{"1":"Algorithm","2":"0","3":"120","4":"0","5":"120","6":"3.988984","7":"0","8":"32.65862","9":"2","10":"1","11":"0","_rn_":"1"},{"1":"Algorithm","2":"1","3":"76","4":"1","5":"77","6":"6.198479","7":"1","8":"34.01940","9":"2","10":"3","11":"0","_rn_":"2"},{"1":"Blanket","2":"0","3":"6","4":"1","5":"6","6":"4.025352","7":"0","8":"30.84426","9":"2","10":"3","11":"1","_rn_":"3"},{"1":"Culture","2":"0","3":"120","4":"0","5":"120","6":"3.850148","7":"0","8":"46.71998","9":"2","10":"2","11":"0","_rn_":"4"},{"1":"Blanket","2":"0","3":"120","4":"0","5":"120","6":"3.610918","7":"0","8":"37.19454","9":"2","10":"1","11":"0","_rn_":"5"},{"1":"Algorithm","2":"0","3":"120","4":"0","5":"120","6":"7.349874","7":"1","8":"14.51494","9":"1","10":"1","11":"0","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br></p>
<p>Run new cox model with stratified variables</p>
<pre class="r"><code>library(broom)
SR &lt;- coxph(Surv(CMTAR, CM) ~ strata(Parity) + strata(DOMYcat) + strata(DOSCM) + PrevCM + Tx + cluster(FARMID), data=SDCTCOW)
tidy(coxph(Surv(CMTAR, CM) ~ strata(Parity) + strata(DOMYcat) + strata(DOSCM) + PrevCM + Tx + cluster(FARMID), data=SDCTCOW))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"PrevCM1","2":"0.3703045","3":"0.2139071","4":"0.2310371","5":"1.602792","6":"0.1089805","7":"-0.08251993","8":"0.8231289"},{"1":"TxCulture","2":"-0.2026634","3":"0.1936929","4":"0.1949754","5":"-1.039431","6":"0.2986043","7":"-0.58480812","8":"0.1794813"},{"1":"TxAlgorithm","2":"-0.1768096","3":"0.1950286","4":"0.1623719","5":"-1.088917","6":"0.2761904","7":"-0.49505269","8":"0.1414335"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> Repeat Schoenfeld residuals</p>
<p>Tx no longer p &lt; 0.05, but is close to the threshold (p = 0.08).</p>
<pre class="r"><code>SR &lt;- cox.zph(SR)
SR</code></pre>
<pre><code>##                rho chisq      p
## PrevCM1     0.0273 0.185 0.6674
## TxCulture   0.1393 3.094 0.0786
## TxAlgorithm 0.0442 0.419 0.5173
## GLOBAL          NA 3.320 0.3449</code></pre>
<p><br> <br> <br> <br> Will split time into 1-60 and 61-120 DIM to see if this difference is meaningful.</p>
<p>Cox model 1-60 DIM</p>
<p>Beta coefficient for Culture = -0.43, Algorithm = -0.08</p>
<pre class="r"><code>SR &lt;- coxph(Surv(CMTAR60, CM60) ~ strata(Parity) + strata(DOMYcat) + strata(DOSCM) + PrevCM + Tx + cluster(FARMID), data=SDCTCOW)
tidy(coxph(Surv(CMTAR60, CM60) ~ strata(Parity) + strata(DOMYcat) + strata(DOSCM) + PrevCM + Tx + cluster(FARMID), data=SDCTCOW))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"PrevCM1","2":"0.17311680","3":"0.3018822","4":"0.2195546","5":"0.7884908","6":"0.43040965","7":"-0.2572023","8":"0.60343594"},{"1":"TxCulture","2":"-0.42805890","3":"0.2714890","4":"0.2532922","5":"-1.6899807","6":"0.09103165","7":"-0.9245024","8":"0.06838465"},{"1":"TxAlgorithm","2":"-0.07752335","3":"0.2491148","4":"0.1460115","5":"-0.5309401","6":"0.59546031","7":"-0.3637006","8":"0.20865390"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> Cox model 61-120 DIM Beta coefficient for Culture = 0.008, Algorithm = -.401</p>
<pre class="r"><code>SR &lt;- coxph(Surv(CMTAR60120, CM60120) ~ strata(Parity) + strata(DOMYcat) + strata(DOSCM) + PrevCM + Tx + cluster(FARMID), data=SDCTCOW)
tidy(coxph(Surv(CMTAR60120, CM60120) ~ strata(Parity) + strata(DOMYcat) + strata(DOSCM) + PrevCM + Tx + cluster(FARMID), data=SDCTCOW))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"PrevCM1","2":"0.560473312","3":"0.3139798","4":"0.3531647","5":"1.58700262","6":"0.1125121","7":"-0.1317168","8":"1.2526634"},{"1":"TxCulture","2":"0.007607158","3":"0.2832040","4":"0.2130130","5":"0.03571219","6":"0.9715119","7":"-0.4098906","8":"0.4251049"},{"1":"TxAlgorithm","2":"-0.401338678","3":"0.3213608","4":"0.2857774","5":"-1.40437497","6":"0.1602072","7":"-0.9614522","8":"0.1587748"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Decision: These differences aren’t sufficient in my opinion to warrant pursuing the 1-60, 61-120 DIM models. An average of the two is appropriate. <br> <br> <br> <br></p>
</div>
<div id="step-5-investigate-effect-measure-modification" class="section level3">
<h3>Step 5: Investigate effect measure modification</h3>
<p>Unable to evluate interaction between Tx &amp; FARMID using Cox regression - Bizzare SE’s, won’t converge.</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(CMTAR, CM) ~ Tx + FARMID + Tx:FARMID + PrevCM + strata(Parity) + strata(DOMYcat) + strata(DOSCM), data=SDCTCOW)
tidy(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"-1.9761090","3":"1.0711839","4":"-1.844789656","5":"0.06506814","6":"-4.07559080","7":"0.1233729"},{"1":"TxAlgorithm","2":"-0.5791955","3":"0.6932119","4":"-0.835524448","5":"0.40342249","6":"-1.93786594","7":"0.7794749"},{"1":"FARMID2","2":"-1.3129289","3":"0.8082604","4":"-1.624388445","5":"0.10429293","6":"-2.89709013","7":"0.2712324"},{"1":"FARMID3","2":"-0.1310092","3":"0.4492199","4":"-0.291637128","5":"0.77056408","6":"-1.01146408","7":"0.7494457"},{"1":"FARMID4","2":"-1.3194437","3":"0.5128414","4":"-2.572810359","5":"0.01008765","6":"-2.32459448","7":"-0.3142930"},{"1":"FARMID5","2":"-0.4522217","3":"0.4766289","4":"-0.948792047","5":"0.34272639","6":"-1.38639710","7":"0.4819537"},{"1":"FARMID6","2":"-1.4596235","3":"1.0734760","4":"-1.359716980","5":"0.17391950","6":"-3.56359781","7":"0.6443507"},{"1":"FARMID7","2":"-0.4027761","3":"0.5425996","4":"-0.742308163","5":"0.45790065","6":"-1.46625165","7":"0.6606995"},{"1":"PrevCM1","2":"0.2331692","3":"0.2167904","4":"1.075551311","5":"0.28212797","6":"-0.19173218","7":"0.6580706"},{"1":"TxCulture:FARMID2","2":"1.4069151","3":"1.6285388","4":"0.863912543","5":"0.38763594","6":"-1.78496229","7":"4.5987925"},{"1":"TxAlgorithm:FARMID2","2":"-0.1599833","3":"1.4094472","4":"-0.113507826","5":"0.90962796","6":"-2.92244907","7":"2.6024825"},{"1":"TxCulture:FARMID3","2":"1.6901344","3":"1.1227452","4":"1.505358809","5":"0.13223185","6":"-0.51040577","7":"3.8906745"},{"1":"TxAlgorithm:FARMID3","2":"0.1506842","3":"0.7805877","4":"0.193039416","5":"0.84692810","6":"-1.37923955","7":"1.6806079"},{"1":"TxCulture:FARMID4","2":"1.4330626","3":"1.1953209","4":"1.198893591","5":"0.23056932","6":"-0.90972337","7":"3.7758486"},{"1":"TxAlgorithm:FARMID4","2":"0.8059296","3":"0.8239862","4":"0.978086349","5":"0.32803162","6":"-0.80905360","7":"2.4209129"},{"1":"TxCulture:FARMID5","2":"2.2680081","3":"1.1315829","4":"2.004279224","5":"0.04504016","6":"0.05014637","7":"4.4858699"},{"1":"TxAlgorithm:FARMID5","2":"0.7374047","3":"0.7937481","4":"0.929016066","5":"0.35288076","6":"-0.81831290","7":"2.2931223"},{"1":"TxCulture:FARMID6","2":"2.5536271","3":"1.6323158","4":"1.564419791","5":"0.11771902","6":"-0.64565302","7":"5.7529072"},{"1":"TxAlgorithm:FARMID6","2":"-14.8645493","3":"2211.2157280","4":"-0.006722342","5":"0.99463639","6":"-Inf","7":"Inf"},{"1":"TxCulture:FARMID7","2":"2.1121142","3":"1.1976253","4":"1.763585178","5":"0.07780185","6":"-0.23518823","7":"4.4594167"},{"1":"TxAlgorithm:FARMID7","2":"0.2879262","3":"0.9117515","4":"0.315794621","5":"0.75215840","6":"-1.49907390","7":"2.0749263"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> Will use logistic regression to assess for interaction between Tx and farm: P &gt; 0.05.</p>
<pre class="r"><code>mm0 &lt;- glm(CM ~ Tx*FARMID + PrevCM + Parity + DOMYcat + DOSCM, data=SDCTCOW, family=binomial)
car::Anova(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["LR Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.8811240","2":"2","3":"6.436746e-01","_rn_":"Tx"},{"1":"35.3391807","2":"6","3":"3.704062e-06","_rn_":"FARMID"},{"1":"0.7628137","2":"1","3":"3.824494e-01","_rn_":"PrevCM"},{"1":"1.9229047","2":"2","3":"3.823372e-01","_rn_":"Parity"},{"1":"1.4655946","2":"1","3":"2.260421e-01","_rn_":"DOMYcat"},{"1":"0.7567776","2":"1","3":"3.843389e-01","_rn_":"DOSCM"},{"1":"12.5922495","2":"12","3":"3.993605e-01","_rn_":"Tx:FARMID"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Decision: No treatment by herd effect measure modification</p>
<p><br> <br> <br> <br> Assess effect measure modification with previous clinical mastitis using Cox regression.</p>
<pre class="r"><code>a &lt;- coxph(Surv(CMTAR, CM) ~ factor(Tx)*factor(PrevCM) + strata(Parity) + cluster(FARMID) + strata(DOMYcat) + strata(DOSCM), data=SDCTCOW)

library(aod)
wald.test(b = coef(a), Sigma = vcov(a), Terms = 4:5)</code></pre>
<pre><code>## Wald test:
## ----------
## 
## Chi-squared test:
## X2 = 11.0, df = 2, P(&gt; X2) = 0.004</code></pre>
<p>Wald test for interaction is p &lt; 0.05. <br> <br> <br> <br> Model output with interaction</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(CMTAR, CM) ~ Tx*PrevCM + strata(Parity) + strata(DOMYcat) + strata(DOSCM) + cluster(FARMID), data=SDCTCOW)
tidy(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"-0.07158051","3":"0.2154578","4":"0.2586480","5":"-0.2767487","6":"0.7819730786","7":"-0.5785214","8":"0.435360345"},{"1":"TxAlgorithm","2":"-0.07732425","3":"0.2166201","4":"0.1602801","5":"-0.4824320","6":"0.6294991079","7":"-0.3914675","8":"0.236818996"},{"1":"PrevCM1","2":"0.72923568","3":"0.3141036","4":"0.2191858","5":"3.3270205","6":"0.0008777991","7":"0.2996394","8":"1.158831974"},{"1":"TxCulture:PrevCM1","2":"-0.68110053","3":"0.4984742","4":"0.3441567","5":"-1.9790421","6":"0.0478112718","7":"-1.3556352","8":"-0.006565844"},{"1":"TxAlgorithm:PrevCM1","2":"-0.52192082","3":"0.5163256","4":"0.2389194","5":"-2.1845058","6":"0.0289251048","7":"-0.9901943","8":"-0.053647387"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>According to this interaction model, the HR (referent = Blanket Tx, no prev CM) for each group are:</p>
<p>Blanket:Prev0 = 1</p>
<p>Blanket:Prev1 = 2.1</p>
<p>Culture:PrevCM0 = 0.93</p>
<p>Culture:PrevCM1 = 0.97</p>
<p>Algorithm:PrevCM0 = 0.93</p>
<p>Algorithm:PrevCM1 = 1.14</p>
<p>This is a counter-intuitive result: hazards of clinical mastitis are higher in blanket cows with previous history of CM.</p>
<p>However, these effect estimates have wide confidence intervals, and this interaction model adds unnecessary complexity and does not change our conclusions.</p>
<p>Decision: Report main effects.</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-6-remove-unnecessary-covariates-backwards-selection-using-10-rule" class="section level3">
<h3>Step 6: Remove unnecessary covariates (backwards selection using 10% rule)</h3>
<p>The order for removing covariates will be in increasing likelihood of being a confounder, which is based on my knowledge about the variables and their distribution in treatment groups.</p>
<p>This order will be: DOMYcat, DOSCM, Parity, PrevCM</p>
<p>Step 6a: Full model</p>
<pre class="r"><code>mm0 &lt;- tidy(coxph(Surv(CMTAR, CM) ~ strata(Parity) + strata(DOMYcat) + strata(DOSCM) + PrevCM + Tx + cluster(FARMID), data=SDCTCOW)) %&gt;% select(&quot;term&quot;,&quot;estimate&quot;)
mm0$HR &lt;- exp(mm0$estimate)
mm0</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["HR"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"PrevCM1","2":"0.3703045","3":"1.4481755"},{"1":"TxCulture","2":"-0.2026634","3":"0.8165530"},{"1":"TxAlgorithm","2":"-0.1768096","3":"0.8379393"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br></p>
<p>Step 6b: removing DOMYcat</p>
<pre class="r"><code>mm0 &lt;- tidy(coxph(Surv(CMTAR, CM) ~ strata(Parity) + strata(DOSCM) + PrevCM + Tx + cluster(FARMID), data=SDCTCOW))%&gt;% select(&quot;term&quot;,&quot;estimate&quot;)
mm0$HR &lt;- exp(mm0$estimate)
mm0</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["HR"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"PrevCM1","2":"0.3600468","3":"1.4333965"},{"1":"TxCulture","2":"-0.1986556","3":"0.8198322"},{"1":"TxAlgorithm","2":"-0.1823606","3":"0.8333008"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Both HR (Culture and Algorithm) changed by &lt;10%. DOMYcat stays out. <br> <br> <br> <br></p>
<p>Step 6c: removing DOSCM</p>
<pre class="r"><code>mm0 &lt;- tidy(coxph(Surv(CMTAR, CM) ~ strata(Parity) + PrevCM + Tx + cluster(FARMID), data=SDCTCOW)) %&gt;% select(&quot;term&quot;,&quot;estimate&quot;)
mm0$HR &lt;- exp(mm0$estimate)
mm0</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["HR"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"PrevCM1","2":"0.3733875","3":"1.4526471"},{"1":"TxCulture","2":"-0.1982981","3":"0.8201254"},{"1":"TxAlgorithm","2":"-0.1751739","3":"0.8393110"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Both HR changed by &lt;10%. DOMYcat stays out. <br> <br> <br> <br></p>
<p>Step 6d: removing Parity</p>
<pre class="r"><code>mm0 &lt;- tidy(coxph(Surv(CMTAR, CM) ~ PrevCM + Tx + cluster(FARMID), data=SDCTCOW)) %&gt;% select(&quot;term&quot;,&quot;estimate&quot;)
mm0$HR &lt;- exp(mm0$estimate)
mm0</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["HR"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"PrevCM1","2":"0.4380779","3":"1.5497256"},{"1":"TxCulture","2":"-0.2133656","3":"0.8078607"},{"1":"TxAlgorithm","2":"-0.1862687","3":"0.8300505"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Both HR changed by &lt;10%. Parity stays out.</p>
<p><br> <br> <br> <br></p>
<p>Step 6e: removing PrevCM</p>
<pre class="r"><code>mm0 &lt;- tidy(coxph(Surv(CMTAR, CM) ~ Tx + cluster(FARMID), data=SDCTCOW)) %&gt;% select(&quot;term&quot;,&quot;estimate&quot;)
mm0$HR &lt;- exp(mm0$estimate)
mm0</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["HR"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"-0.2041838","3":"0.8153125"},{"1":"TxAlgorithm","2":"-0.1882316","3":"0.8284228"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Both HR changed by &lt;10%. PrevCM stays out. <br> <br> <br> <br></p>
</div>
<div id="step-7a-reporting-final-cox-model-for-clinical-mastitis-1-120-dim" class="section level3">
<h3>Step 7a: Reporting final cox model for clinical mastitis (1-120 DIM)</h3>
<p>No covariates included, as no evidence for confounding.</p>
<pre class="r"><code>CoxCM &lt;- tidy(coxph(Surv(CMTAR, CM) ~ Tx + cluster(FARMID), data=SDCTCOW))
CoxCM$HR &lt;- exp(CoxCM$estimate)
CoxCM$LCL &lt;- exp(CoxCM$conf.low)
CoxCM$UCL &lt;- exp(CoxCM$conf.high)
CoxCM &lt;- CoxCM %&gt;% select(term,HR,LCL,UCL,robust.se,p.value)
CoxCM</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["HR"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["LCL"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UCL"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"0.8153125","3":"0.5772631","4":"1.151528","5":"0.1761631","6":"0.2464313"},{"1":"TxAlgorithm","2":"0.8284228","3":"0.6268561","4":"1.094804","5":"0.1422509","6":"0.1857566"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br></p>
<div id="checking-schoenfield-residuals-for-tx-in-final-model" class="section level4">
<h4>Checking Schoenfield residuals for Tx in final model</h4>
<pre class="r"><code>SR &lt;- coxph(Surv(CMTAR, CM) ~ Tx + cluster(FARMID), data=SDCTCOW)
cox.zph(SR)</code></pre>
<pre><code>##                  rho    chisq     p
## TxCulture    0.12471 2.077891 0.149
## TxAlgorithm -0.00225 0.000429 0.983
## GLOBAL            NA 2.596282 0.273</code></pre>
<pre class="r"><code>SR &lt;- cox.zph(SR)
ggcoxzph(SR,var = c(&quot;TxCulture&quot;,&quot;TxAlgorithm&quot;))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-32-1.png" width="672" /> Sufficient evidence to use Cox model.</p>
<p><br> <br> <br></p>
</div>
</div>
<div id="step-7b-reporting-final-cox-model-for-clinical-mastitis-1-120-dim-using-p-value-based-backwards-stepwise-selection" class="section level3">
<h3>Step 7b: Reporting final cox model for clinical mastitis (1-120 DIM) using P-value based backwards stepwise selection</h3>
<pre class="r"><code>CoxCM &lt;- coxph(Surv(CMTAR, CM) ~ Tx + Parity + cluster(FARMID), data=SDCTCOW) %&gt;% tidy()
CoxCM$HR &lt;- exp(CoxCM$estimate)
CoxCM$LCL &lt;- exp(CoxCM$conf.low)
CoxCM$UCL &lt;- exp(CoxCM$conf.high)
CoxCM &lt;- CoxCM %&gt;% select(term,HR,LCL,UCL,robust.se,p.value)
CoxCM</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["HR"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["LCL"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UCL"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"0.8249745","3":"0.5834794","4":"1.166421","5":"0.17670902","6":"0.276237039"},{"1":"TxAlgorithm","2":"0.8373865","3":"0.6240071","4":"1.123731","5":"0.15006602","6":"0.236963846"},{"1":"Parity2","2":"1.3633462","3":"1.1264587","4":"1.650050","5":"0.09738106","6":"0.001458701"},{"1":"Parity3","2":"1.5112228","3":"0.8491170","4":"2.689611","5":"0.29412651","6":"0.160353777"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Estimates are very similar to those found using 10% rule. <br> <br> <br> <br></p>
</div>
</div>
</div>
<div id="outcome-2-culling-death" class="section level1">
<h1>Outcome 2: Culling / Death</h1>
<div id="kaplan-meier-curve-log-rank-test-for-cullingdeath" class="section level2">
<h2>Kaplan Meier curve &amp; log rank test for culling/death</h2>
<pre class="r"><code>library(gmodels)
CrossTable(SDCTCOW$Tx,SDCTCOW$Cull2,prop.c=FALSE,prop.t=FALSE,prop.chisq = FALSE)</code></pre>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |           N / Row Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  1211 
## 
##  
##              | SDCTCOW$Cull2 
##   SDCTCOW$Tx |         0 |         1 | Row Total | 
## -------------|-----------|-----------|-----------|
##      Blanket |       363 |        44 |       407 | 
##              |     0.892 |     0.108 |     0.336 | 
## -------------|-----------|-----------|-----------|
##      Culture |       370 |        40 |       410 | 
##              |     0.902 |     0.098 |     0.339 | 
## -------------|-----------|-----------|-----------|
##    Algorithm |       352 |        42 |       394 | 
##              |     0.893 |     0.107 |     0.325 | 
## -------------|-----------|-----------|-----------|
## Column Total |      1085 |       126 |      1211 | 
## -------------|-----------|-----------|-----------|
## 
## </code></pre>
<p>Kaplan Meier curve</p>
<pre class="r"><code>KM &lt;- survfit(Surv(Cull2TAR, Cull2) ~ Tx, data = SDCTCOW)
ggsurvplot(KM, data = SDCTCOW,  title = &quot;&quot;, pval = T, conf.int = F,risk.table.col = &quot;Tx&quot;,risk.table = T, risk.table.y.text.col = TRUE , surv.plot.height = 5, legend.labs = c(&quot;Blanket&quot;,&quot;Culture&quot;,&quot;Algorithm&quot;), tables.theme = theme_cleantable(), ggtheme = theme_bw())</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-35-1.png" width="672" /> <br> <br> <br> <br></p>
<p>Log-Rank test</p>
<pre class="r"><code>survdiff(Surv(Cull2TAR, Cull2) ~ Tx,data=SDCTCOW,rho=0)</code></pre>
<pre><code>## Call:
## survdiff(formula = Surv(Cull2TAR, Cull2) ~ Tx, data = SDCTCOW, 
##     rho = 0)
## 
##                N Observed Expected (O-E)^2/E (O-E)^2/V
## Tx=Blanket   407       44     42.1    0.0891     0.134
## Tx=Culture   410       40     43.0    0.2128     0.323
## Tx=Algorithm 394       42     40.9    0.0290     0.043
## 
##  Chisq= 0.3  on 2 degrees of freedom, p= 0.8</code></pre>
<p><br> <br> <br></p>
</div>
<div id="cox-proportional-hazards-regression-for-culling-or-death-1-120-dim" class="section level2">
<h2>Cox proportional hazards regression for culling or death (1-120 DIM)</h2>
</div>
<div id="model-building-plan-1" class="section level2">
<h2>Model building plan</h2>
<p>Model type: Cox proportional hazards analysis with farm included as a cluster variable to account for lack of indepedence.</p>
<p>Step 1: Identify potential confouders using a directed acyclic graph (DAG)</p>
<p>Step 2: Identify correlated variables using pearson and kendalls correlation coefficients</p>
<p>Step 3: Create model with all potential confounders</p>
<p>Step 4: Investigate if covariates meet proportional hazards assumption</p>
<p>Step 5: Investigate potential effect measure modification</p>
<p>Step 6: Remove unneccesary covariates in backwards stepwise fashion using 10% rule (i.e. if HR changes by &gt;10% after removal of covariate, the covariate is retained in the model)</p>
<p>Step 7: Report final model</p>
<div id="steps-1-2-identify-potential-confouders-using-a-directed-acyclic-graph-dag" class="section level3">
<h3>Steps 1 &amp; 2: Identify potential confouders using a directed acyclic graph (DAG)</h3>
<pre class="r"><code>library(DiagrammeR)
mermaid(&quot;graph LR
        T(Treatment)--&gt;U(Culling or Death)
        A(Age)--&gt;T
        P(Parity)--&gt;T
        M(Yield at dry-off)--&gt;T
        S(SCC during prev lactation)--&gt;T
        C(CM in prev lact)--&gt;T
        A--&gt;U
        P--&gt;U
        M--&gt;U
        S--&gt;U
        C--&gt;U
        C--&gt;M
        P--&gt;C
        P--&gt;S
        P--&gt;M
        A--&gt;P
        A--&gt;C
        A--&gt;S
        A--&gt;M
        M--&gt;S
        C--&gt;S
        style A fill:#FFFFFF, stroke-width:0px
        style T fill:#FFFFFF, stroke-width:2px
        style P fill:#FFFFFF, stroke-width:0px
        style M fill:#FFFFFF, stroke-width:0px
        style S fill:#FFFFFF, stroke-width:0px
        style C fill:#FFFFFF, stroke-width:0px
        style I fill:#FFFFFF, stroke-width:0px
        style U fill:#FFFFFF, stroke-width:2px
        &quot;)</code></pre>
<p><div id="htmlwidget-848a01cd992e65b272c6" style="width:960px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-848a01cd992e65b272c6">{"x":{"diagram":"graph LR\n        T(Treatment)-->U(Culling or Death)\n        A(Age)-->T\n        P(Parity)-->T\n        M(Yield at dry-off)-->T\n        S(SCC during prev lactation)-->T\n        C(CM in prev lact)-->T\n        A-->U\n        P-->U\n        M-->U\n        S-->U\n        C-->U\n        C-->M\n        P-->C\n        P-->S\n        P-->M\n        A-->P\n        A-->C\n        A-->S\n        A-->M\n        M-->S\n        C-->S\n        style A fill:#FFFFFF, stroke-width:0px\n        style T fill:#FFFFFF, stroke-width:2px\n        style P fill:#FFFFFF, stroke-width:0px\n        style M fill:#FFFFFF, stroke-width:0px\n        style S fill:#FFFFFF, stroke-width:0px\n        style C fill:#FFFFFF, stroke-width:0px\n        style I fill:#FFFFFF, stroke-width:0px\n        style U fill:#FFFFFF, stroke-width:2px\n        "},"evals":[],"jsHooks":[]}</script> According to this DAG, I may need to control for the following variables:</p>
<p>Parity [“Parity”]. Will not offer Age [“Age”] as it is highly correlated.</p>
<p>Yield at most recent test before dry off [“DOMY”]</p>
<p>Somatic cell count at last herd test during previous lactation [“DOSCC”] &lt;- will not offer PrevSCCHI as it was correlated with DOSCC</p>
<p>Clinical mastitis in previous lactation [“PrevCM”]</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-3-create-model-with-all-potential-confounders" class="section level3">
<h3>Step 3: Create model with all potential confounders</h3>
<p>Cows that did not calve are excluded (left censored)</p>
<p>Reason for R censor = 120 DIM</p>
<pre class="r"><code>library(broom)
library(survival)
coxph(Surv(Cull2TAR, Cull2) ~ Parity + DOMY + DOSCC + PrevCM + Tx + cluster(FARMID), data=SDCTCOW)</code></pre>
<pre><code>## Call:
## coxph(formula = Surv(Cull2TAR, Cull2) ~ Parity + DOMY + DOSCC + 
##     PrevCM + Tx + cluster(FARMID), data = SDCTCOW)
## 
##                 coef exp(coef) se(coef) robust se      z        p
## Parity2      0.39524   1.48475  0.25866   0.21257  1.859  0.06298
## Parity3      1.13923   3.12436  0.23351   0.23115  4.929 8.29e-07
## DOMY        -0.01446   0.98564  0.01107   0.01471 -0.983  0.32560
## DOSCC        0.08981   1.09396  0.08514   0.05241  1.714  0.08660
## PrevCM1      0.26788   1.30719  0.22819   0.09322  2.874  0.00406
## TxCulture   -0.09850   0.90619  0.21940   0.21233 -0.464  0.64271
## TxAlgorithm  0.01074   1.01079  0.21583   0.23312  0.046  0.96327
## 
## Likelihood ratio test=44.51  on 7 df, p=1.706e-07
## n= 1211, number of events= 126</code></pre>
<p><br> <br> <br> <br></p>
</div>
<div id="step-4-investigate-if-covariates-meet-proportional-hazards-assumption" class="section level3">
<h3>Step 4: Investigate if covariates meet proportional hazards assumption</h3>
<p>Both DOSCC and DOMY don’t meet the assumption of proportional hazards</p>
<pre class="r"><code>SR &lt;- cox.zph(coxph(Surv(Cull2TAR, Cull2) ~ Parity + DOMY + DOSCC + PrevCM + Tx + cluster(FARMID), data=SDCTCOW))
SR</code></pre>
<pre><code>##                 rho chisq       p
## Parity2     -0.1157 2.607 0.10639
## Parity3     -0.0343 0.209 0.64753
## DOMY         0.1521 7.402 0.00652
## DOSCC        0.1462 5.471 0.01934
## PrevCM1     -0.1220 2.530 0.11172
## TxCulture    0.1222 3.313 0.06872
## TxAlgorithm  0.0815 1.396 0.23741
## GLOBAL           NA 8.182 0.31686</code></pre>
<p><br> <br> <br></p>
<p>Schoenfield residual plots</p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;TxCulture&quot;,&quot;TxAlgorithm&quot;))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-40-1.png" width="672" /> <br> <br> <br> <br></p>
<p>DOSCC and DOMY don’t meet the assumption of proportional hazards</p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;DOSCC&quot;, &quot;DOMY&quot;))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;Parity2&quot;,&quot;Parity3&quot;))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<pre class="r"><code>ggcoxzph(SR,var = c(&quot;PrevCM1&quot;))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-43-1.png" width="672" /> <br> <br> <br> <br></p>
<p>Refit cox model with seperate baselines (stratified) for DOMY and DOSCC.</p>
<p>No evidence of other time-varying covariates or predictors (Tx).</p>
<pre class="r"><code>SR &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Parity + strata(DOMYcat) + strata(DOSCM) + PrevCM + Tx + cluster(FARMID), data=SDCTCOW)
SR &lt;- cox.zph(SR)
SR</code></pre>
<pre><code>##                  rho    chisq     p
## Parity2     -0.05884 0.412749 0.521
## Parity3     -0.00113 0.000217 0.988
## PrevCM1     -0.06962 0.500950 0.479
## TxCulture    0.10086 1.689182 0.194
## TxAlgorithm  0.07741 1.091294 0.296
## GLOBAL            NA 2.214228 0.819</code></pre>
<p><br> <br> <br> <br></p>
</div>
<div id="step-5-assess-for-effect-measure-modification" class="section level3">
<h3>Step 5: Assess for effect measure modification</h3>
<p>Tx : FARMID - could not assess this using Cox regression as model did not converge or reported unusually large SEs for some interaction terms.</p>
<pre class="r"><code>SR &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx*FARMID + Parity + PrevCM + Parity + strata(DOMYcat) + strata(DOSCM), data=SDCTCOW)
tidy(SR)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"-1.030714623","3":"0.8179399","4":"-1.260134918","5":"2.076207e-01","6":"-2.63384736","7":"0.57241811"},{"1":"TxAlgorithm","2":"-0.071316087","3":"0.6468953","4":"-0.110243623","5":"9.122162e-01","6":"-1.33920767","7":"1.19657550"},{"1":"FARMID2","2":"-0.519082508","3":"0.7115145","4":"-0.729545928","5":"4.656678e-01","6":"-1.91362531","7":"0.87546029"},{"1":"FARMID3","2":"-0.440636799","3":"0.5157232","4":"-0.854405629","5":"3.928803e-01","6":"-1.45143568","7":"0.57016209"},{"1":"FARMID4","2":"-1.105483282","3":"0.5458156","4":"-2.025378842","5":"4.282848e-02","6":"-2.17526212","7":"-0.03570445"},{"1":"FARMID5","2":"-0.297699699","3":"0.5067735","4":"-0.587441331","5":"5.569073e-01","6":"-1.29095751","7":"0.69555811"},{"1":"FARMID6","2":"-0.952934056","3":"1.0839425","4":"-0.879137122","5":"3.793269e-01","6":"-3.07742224","7":"1.17155413"},{"1":"FARMID7","2":"-1.009659361","3":"0.7104262","4":"-1.421202246","5":"1.552580e-01","6":"-2.40206920","7":"0.38275047"},{"1":"Parity2","2":"0.476051908","3":"0.2591668","4":"1.836855546","5":"6.623122e-02","6":"-0.03190562","7":"0.98400943"},{"1":"Parity3","2":"1.239300299","3":"0.2348205","4":"5.277649139","5":"1.308517e-07","6":"0.77906054","7":"1.69954006"},{"1":"PrevCM1","2":"0.263563013","3":"0.2314095","4":"1.138946523","5":"2.547255e-01","6":"-0.18999122","7":"0.71711724"},{"1":"TxCulture:FARMID2","2":"1.130807639","3":"1.1586989","4":"0.975928826","5":"3.290997e-01","6":"-1.14020044","7":"3.40181572"},{"1":"TxAlgorithm:FARMID2","2":"0.379211462","3":"1.0029755","4":"0.378086470","5":"7.053664e-01","6":"-1.58658437","7":"2.34500729"},{"1":"TxCulture:FARMID3","2":"0.326037353","3":"0.9629354","4":"0.338586954","5":"7.349209e-01","6":"-1.56128128","7":"2.21335599"},{"1":"TxAlgorithm:FARMID3","2":"-0.979058899","3":"0.8729504","4":"-1.121551558","5":"2.620532e-01","6":"-2.69001027","7":"0.73189248"},{"1":"TxCulture:FARMID4","2":"1.487232904","3":"0.9313644","4":"1.596832441","5":"1.103031e-01","6":"-0.33820780","7":"3.31267360"},{"1":"TxAlgorithm:FARMID4","2":"0.629669619","3":"0.7884639","4":"0.798602970","5":"4.245207e-01","6":"-0.91569124","7":"2.17503048"},{"1":"TxCulture:FARMID5","2":"0.957831800","3":"0.9176411","4":"1.043797883","5":"2.965789e-01","6":"-0.84071164","7":"2.75637524"},{"1":"TxAlgorithm:FARMID5","2":"0.004416652","3":"0.7699106","4":"0.005736578","5":"9.954229e-01","6":"-1.50458039","7":"1.51341370"},{"1":"TxCulture:FARMID6","2":"-13.761425103","3":"1597.0195959","4":"-0.008616942","5":"9.931248e-01","6":"-Inf","7":"Inf"},{"1":"TxAlgorithm:FARMID6","2":"0.131517354","3":"1.5580868","4":"0.084409516","5":"9.327308e-01","6":"-2.92227671","7":"3.18531141"},{"1":"TxCulture:FARMID7","2":"1.580787692","3":"1.1191922","4":"1.412436259","5":"1.578215e-01","6":"-0.61278878","7":"3.77436416"},{"1":"TxAlgorithm:FARMID7","2":"0.676073765","3":"0.9759424","4":"0.692739407","5":"4.884731e-01","6":"-1.23673821","7":"2.58888574"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> I will assess effect Tx:farm interaction using logistic regression:</p>
<p>Wald test for interaction term was P &gt; 0.05.</p>
<pre class="r"><code>mm0 &lt;- glm(CM ~ Tx*FARMID + Parity + PrevCM + Parity + DOMYcat + DOSCM, data=SDCTCOW)
car::Anova(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["LR Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.9242209","2":"2","3":"6.299527e-01","_rn_":"Tx"},{"1":"33.5731753","2":"6","3":"8.132115e-06","_rn_":"FARMID"},{"1":"1.9527858","2":"2","3":"3.766673e-01","_rn_":"Parity"},{"1":"1.0385499","2":"1","3":"3.081590e-01","_rn_":"PrevCM"},{"1":"1.5732889","2":"1","3":"2.097300e-01","_rn_":"DOMYcat"},{"1":"0.8095534","2":"1","3":"3.682523e-01","_rn_":"DOSCM"},{"1":"10.1740957","2":"12","3":"6.006904e-01","_rn_":"Tx:FARMID"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> Assess for other interactions using Wald testfrom Cox regression.</p>
<p>Wald test was P &gt; 0.05 for Tx:PrevCM interaction</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx*PrevCM + Parity + strata(DOMYcat) + strata(DOSCM) + cluster(FARMID), data=SDCTCOW)
summary(mm0)</code></pre>
<pre><code>## Call:
## coxph(formula = Surv(Cull2TAR, Cull2) ~ Tx * PrevCM + Parity + 
##     strata(DOMYcat) + strata(DOSCM) + cluster(FARMID), data = SDCTCOW)
## 
##   n= 1211, number of events= 126 
## 
##                         coef exp(coef) se(coef) robust se      z Pr(&gt;|z|)
## TxCulture           -0.02411   0.97618  0.24667   0.23595 -0.102   0.9186
## TxAlgorithm          0.05495   1.05649  0.24266   0.27674  0.199   0.8426
## PrevCM1              0.49435   1.63943  0.36416   0.20400  2.423   0.0154
## Parity2              0.41575   1.51550  0.25731   0.21398  1.943   0.0520
## Parity3              1.17829   3.24881  0.23075   0.25675  4.589 4.45e-06
## TxCulture:PrevCM1   -0.40970   0.66385  0.53890   0.33877 -1.209   0.2265
## TxAlgorithm:PrevCM1 -0.21937   0.80303  0.53502   0.70719 -0.310   0.7564
##                        
## TxCulture              
## TxAlgorithm            
## PrevCM1             *  
## Parity2             .  
## Parity3             ***
## TxCulture:PrevCM1      
## TxAlgorithm:PrevCM1    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                     exp(coef) exp(-coef) lower .95 upper .95
## TxCulture              0.9762     1.0244    0.6147     1.550
## TxAlgorithm            1.0565     0.9465    0.6142     1.817
## PrevCM1                1.6394     0.6100    1.0991     2.445
## Parity2                1.5155     0.6598    0.9964     2.305
## Parity3                3.2488     0.3078    1.9642     5.374
## TxCulture:PrevCM1      0.6638     1.5064    0.3417     1.290
## TxAlgorithm:PrevCM1    0.8030     1.2453    0.2008     3.211
## 
## Concordance= 0.64  (se = 0.03 )
## Likelihood ratio test= 33.79  on 7 df,   p=2e-05
## Wald test            = 1281  on 7 df,   p=&lt;2e-16
## Score (logrank) test = 36.55  on 7 df,   p=6e-06,   Robust = 7  p=0.4
## 
##   (Note: the likelihood ratio and score tests assume independence of
##      observations within a cluster, the Wald and robust score tests do not).</code></pre>
<pre class="r"><code>wald.test(b = coef(mm0), Sigma = vcov(mm0), Terms = 6:7)</code></pre>
<pre><code>## Wald test:
## ----------
## 
## Chi-squared test:
## X2 = 1.6, df = 2, P(&gt; X2) = 0.46</code></pre>
<p><br> <br> <br> <br> Wald test was P &lt; 0.05 for Tx:Parity interaction .</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx*Parity + PrevCM + strata(DOMYcat) + strata(DOSCM) + cluster(FARMID), data=SDCTCOW)
summary(mm0)</code></pre>
<pre><code>## Call:
## coxph(formula = Surv(Cull2TAR, Cull2) ~ Tx * Parity + PrevCM + 
##     strata(DOMYcat) + strata(DOSCM) + cluster(FARMID), data = SDCTCOW)
## 
##   n= 1211, number of events= 126 
## 
##                        coef exp(coef) se(coef) robust se      z Pr(&gt;|z|)
## TxCulture            0.5382    1.7130   0.5005    0.4124  1.305 0.191869
## TxAlgorithm          0.5758    1.7786   0.5080    0.5537  1.040 0.298327
## Parity2              0.8960    2.4498   0.4961    0.4546  1.971 0.048749
## Parity3              1.7523    5.7680   0.4572    0.4022  4.357 1.32e-05
## PrevCM1              0.3018    1.3522   0.2277    0.1047  2.882 0.003946
## TxCulture:Parity2   -0.6590    0.5173   0.6640    0.7136 -0.924 0.355691
## TxAlgorithm:Parity2 -0.6252    0.5352   0.6531    0.6359 -0.983 0.325518
## TxCulture:Parity3   -0.8959    0.4082   0.5861    0.2552 -3.511 0.000446
## TxAlgorithm:Parity3 -0.7392    0.4775   0.5900    0.4252 -1.739 0.082111
##                        
## TxCulture              
## TxAlgorithm            
## Parity2             *  
## Parity3             ***
## PrevCM1             ** 
## TxCulture:Parity2      
## TxAlgorithm:Parity2    
## TxCulture:Parity3   ***
## TxAlgorithm:Parity3 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##                     exp(coef) exp(-coef) lower .95 upper .95
## TxCulture              1.7130     0.5838    0.7633    3.8440
## TxAlgorithm            1.7786     0.5622    0.6009    5.2648
## Parity2                2.4498     0.4082    1.0049    5.9721
## Parity3                5.7680     0.1734    2.6224   12.6871
## PrevCM1                1.3522     0.7395    1.1014    1.6602
## TxCulture:Parity2      0.5173     1.9329    0.1278    2.0949
## TxAlgorithm:Parity2    0.5352     1.8686    0.1539    1.8610
## TxCulture:Parity3      0.4082     2.4496    0.2476    0.6731
## TxAlgorithm:Parity3    0.4775     2.0943    0.2075    1.0987
## 
## Concordance= 0.651  (se = 0.025 )
## Likelihood ratio test= 35.95  on 9 df,   p=4e-05
## Wald test            = 89593  on 9 df,   p=&lt;2e-16
## Score (logrank) test = 38.57  on 9 df,   p=1e-05,   Robust = 7  p=0.6
## 
##   (Note: the likelihood ratio and score tests assume independence of
##      observations within a cluster, the Wald and robust score tests do not).</code></pre>
<pre class="r"><code>wald.test(b = coef(mm0), Sigma = vcov(mm0), Terms = 6:9)</code></pre>
<pre><code>## Wald test:
## ----------
## 
## Chi-squared test:
## X2 = 658.3, df = 4, P(&gt; X2) = 0.0</code></pre>
<p><br> <br> <br> Investigate potential effect measure modification by doing stratified models</p>
<p>Parity = 1 Frequency table</p>
<pre class="r"><code>table(SDCTCOW$Tx[SDCTCOW$Parity==1],SDCTCOW$Cull2[SDCTCOW$Parity==1])</code></pre>
<pre><code>##            
##               0   1
##   Blanket   152   6
##   Culture   173  12
##   Algorithm 156  11</code></pre>
<p><br> <br> <br></p>
<div id="model-parity-1" class="section level4">
<h4>Model (Parity = 1)</h4>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx + PrevCM + strata(DOMYcat) + strata(DOSCM) + cluster(FARMID), data=SDCTCOW[SDCTCOW$Parity==1,]) %&gt;% tidy()
mm0$HR &lt;- exp(mm0$estimate)
mm0$LCL &lt;- exp(mm0$conf.low)
mm0$UCL &lt;- exp(mm0$conf.high)
mm0 %&gt;% select(&quot;term&quot;,&quot;HR&quot;,&quot;LCL&quot;,&quot;UCL&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["HR"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["LCL"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UCL"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"1.726914","3":"0.7342093","4":"4.061826"},{"1":"TxAlgorithm","2":"1.821076","3":"0.6039871","4":"5.490708"},{"1":"PrevCM1","2":"1.672937","3":"1.0529858","4":"2.657889"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br></p>
</div>
<div id="parity-2" class="section level4">
<h4>Parity = 2</h4>
<p>Frequency table</p>
<pre class="r"><code>table(SDCTCOW$Tx[SDCTCOW$Parity==2],SDCTCOW$Cull2[SDCTCOW$Parity==2])</code></pre>
<pre><code>##            
##               0   1
##   Blanket   120  13
##   Culture    99   9
##   Algorithm 112  11</code></pre>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx + PrevCM + strata(DOMYcat) + strata(DOSCM) + cluster(FARMID), data=SDCTCOW[SDCTCOW$Parity==2,]) %&gt;% tidy()
mm0$HR &lt;- exp(mm0$estimate)
mm0$LCL &lt;- exp(mm0$conf.low)
mm0$UCL &lt;- exp(mm0$conf.high)
mm0 %&gt;% select(&quot;term&quot;,&quot;HR&quot;,&quot;LCL&quot;,&quot;UCL&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["HR"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["LCL"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UCL"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"0.8598211","3":"0.3881163","4":"1.904822"},{"1":"TxAlgorithm","2":"0.9415963","3":"0.5399025","4":"1.642155"},{"1":"PrevCM1","2":"1.3883287","3":"0.7667362","4":"2.513846"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br></p>
</div>
<div id="parity-3-or-greater" class="section level4">
<h4>Parity = 3 or greater</h4>
<p>Frequency table</p>
<pre class="r"><code>table(SDCTCOW$Tx[SDCTCOW$Parity==3],SDCTCOW$Cull2[SDCTCOW$Parity==3])</code></pre>
<pre><code>##            
##              0  1
##   Blanket   91 25
##   Culture   98 19
##   Algorithm 84 20</code></pre>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx + PrevCM + strata(DOMYcat) + strata(DOSCM) + cluster(FARMID), data=SDCTCOW[SDCTCOW$Parity==3,]) %&gt;% tidy
mm0$HR &lt;- exp(mm0$estimate)
mm0$LCL &lt;- exp(mm0$conf.low)
mm0$UCL &lt;- exp(mm0$conf.high)
mm0 %&gt;% select(&quot;term&quot;,&quot;HR&quot;,&quot;LCL&quot;,&quot;UCL&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["HR"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["LCL"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UCL"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"0.7034597","3":"0.3534810","4":"1.399949"},{"1":"TxAlgorithm","2":"0.8447025","3":"0.5619642","4":"1.269694"},{"1":"PrevCM1","2":"1.2873182","3":"1.0356261","4":"1.600180"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This finding suggests that potential culling risks associated with SDCT may be higher in parity 1 cows than in multiparous animals. However these HR estimates in all 3 parity groups are imprecise (wide confidence intervals) because of a small number of culling/death events. For example, in lactation 1 animals: 6 in BDCT, 11 in Algorithm and 12 in Culture. Therefore, this difference in effects across levels of parity may be due to chance alone, and not worth investigating too closely.</p>
<p>Decision: Report main effects.</p>
<p><br> <br> <br></p>
</div>
</div>
<div id="step-6-remove-unnecessary-covariates-backwards-selection-using-10-rule-1" class="section level3">
<h3>Step 6: Remove unnecessary covariates (backwards selection using 10% rule)</h3>
<p>The order for removing covariates will be in increasing likelihood of being a confounder, which is based on my knowledge about the variables and their distribution in treatment groups.</p>
<p>This order will be: DOMYcat, DOSCM, PrevCM, Parity</p>
<p>Step 6a: Full model</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx + PrevCM + Parity + strata(DOMYcat) + strata(DOSCM) + cluster(FARMID), data=SDCTCOW) %&gt;% tidy() %&gt;% select(&quot;term&quot;,&quot;estimate&quot;)
mm0$HR &lt;- exp(mm0$estimate)
mm0</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["HR"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"-0.110431398","3":"0.8954478"},{"1":"TxAlgorithm","2":"0.008981413","3":"1.0090219"},{"1":"PrevCM1","2":"0.289793044","3":"1.3361509"},{"1":"Parity2","2":"0.425627333","3":"1.5305503"},{"1":"Parity3","2":"1.172860644","3":"3.2312228"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> Step 6b: removing DOMYcat</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx + PrevCM + Parity + strata(DOSCM) + cluster(FARMID), data=SDCTCOW) %&gt;% tidy() %&gt;% select(&quot;term&quot;,&quot;estimate&quot;)
mm0$HR &lt;- exp(mm0$estimate)
mm0</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["HR"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"-0.11226520","3":"0.8938072"},{"1":"TxAlgorithm","2":"0.00396691","3":"1.0039748"},{"1":"PrevCM1","2":"0.28139207","3":"1.3249730"},{"1":"Parity2","2":"0.43550200","3":"1.5457388"},{"1":"Parity3","2":"1.19494503","3":"3.3033762"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>HR for culture and algorithm didn’t change by &gt;10%. DOMYcat stays out. <br> <br> <br> <br></p>
<p>Step 6c: removing DOSCM</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx + PrevCM + Parity + cluster(FARMID), data=SDCTCOW) %&gt;% tidy() %&gt;% select(&quot;term&quot;,&quot;estimate&quot;)
mm0$HR &lt;- exp(mm0$estimate)
mm0</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["HR"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"-0.119669498","3":"0.8872136"},{"1":"TxAlgorithm","2":"0.004639006","3":"1.0046498"},{"1":"PrevCM1","2":"0.323970894","3":"1.3826071"},{"1":"Parity2","2":"0.457311401","3":"1.5798208"},{"1":"Parity3","2":"1.234993433","3":"3.4383559"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>HR changed by &lt;10%. DOSCM stays out. <br> <br> <br> <br></p>
<p>Step 6d: removing PrevCM</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx + Parity + cluster(FARMID), data=SDCTCOW) %&gt;% tidy() %&gt;% select(&quot;term&quot;,&quot;estimate&quot;)
mm0$HR &lt;- exp(mm0$estimate)
mm0</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["HR"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"-0.108516876","3":"0.8971638"},{"1":"TxAlgorithm","2":"0.005213935","3":"1.0052276"},{"1":"Parity2","2":"0.481108574","3":"1.6178669"},{"1":"Parity3","2":"1.281254608","3":"3.6011549"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>HR changed by &lt;10%. Leave PrevCM out. <br> <br> <br> <br> Step 6e: removing Parity</p>
<pre class="r"><code>mm0 &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx + cluster(FARMID), data=SDCTCOW) %&gt;% tidy() %&gt;% select(&quot;term&quot;,&quot;estimate&quot;)
mm0$HR &lt;- exp(mm0$estimate)
mm0</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["HR"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"-0.11806382","3":"0.8886393"},{"1":"TxAlgorithm","2":"-0.01883667","3":"0.9813396"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>HR changed by &lt;10%. Parity stays out.</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-7a-final-cox-model-for-culling-or-death-1---120-dim" class="section level3">
<h3>Step 7a: Final cox model for culling or death (1 - 120 DIM)</h3>
<p>No covariates included, as no evidence for confounding.</p>
<pre class="r"><code>CoxCull &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx + cluster(FARMID), data=SDCTCOW) %&gt;% tidy()
CoxCull$HR &lt;- exp(CoxCull$estimate)
CoxCull$LCL &lt;- exp(CoxCull$conf.low)
CoxCull$UCL &lt;- exp(CoxCull$conf.high)
CoxCull &lt;- CoxCull %&gt;% select(term,HR,LCL,UCL,robust.se,p.value)
CoxCull</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["HR"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["LCL"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UCL"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"0.8886393","3":"0.5991216","4":"1.318063","5":"0.2011398","6":"0.5572213"},{"1":"TxAlgorithm","2":"0.9813396","3":"0.6736385","4":"1.429591","5":"0.1919550","6":"0.9218286"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br></p>
<div id="check-schoenfield-residuals-for-final-model" class="section level4">
<h4>Check schoenfield residuals for final model</h4>
<pre class="r"><code>SR &lt;- coxph(Surv(Cull2TAR, Cull2) ~ Tx + cluster(FARMID), data=SDCTCOW)
cox.zph(SR)</code></pre>
<pre><code>##                rho chisq     p
## TxCulture   0.1100  1.52 0.217
## TxAlgorithm 0.0951  1.12 0.290
## GLOBAL          NA  1.53 0.466</code></pre>
<pre class="r"><code>SR &lt;- cox.zph(SR)
ggcoxzph(SR,var = c(&quot;TxCulture&quot;,&quot;TxAlgorithm&quot;))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
</div>
<div id="step-7b-final-cox-model-for-culling-or-death-1---120-dim-using-p-value-based-backwards-stepwise-selection" class="section level3">
<h3>Step 7b: Final cox model for culling or death (1 - 120 DIM) using P-value based backwards stepwise selection</h3>
<pre class="r"><code>CoxCull &lt;- coxph(Surv(CullTAR, Cull2) ~ Tx + Parity + DOSCC + PrevCM + cluster(FARMID), data=SDCTCOW) %&gt;% tidy()
CoxCull$HR &lt;- exp(CoxCull$estimate)
CoxCull$LCL &lt;- exp(CoxCull$conf.low)
CoxCull$UCL &lt;- exp(CoxCull$conf.high)
CoxCull &lt;- CoxCull %&gt;% select(term,HR,LCL,UCL,robust.se,p.value)
CoxCull</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["HR"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["LCL"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UCL"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["robust.se"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"TxCulture","2":"0.8899694","3":"0.5862893","4":"1.350947","5":"0.21294972","6":"5.841056e-01"},{"1":"TxAlgorithm","2":"0.9969941","3":"0.6348126","4":"1.565812","5":"0.23031802","6":"9.895713e-01"},{"1":"Parity2","2":"1.5028382","3":"0.9897770","4":"2.281850","5":"0.21308098","6":"5.590953e-02"},{"1":"Parity3","2":"3.1383696","3":"1.9263831","4":"5.112879","5":"0.24901438","6":"4.370841e-06"},{"1":"DOSCC","2":"1.1508682","3":"1.0556688","4":"1.254653","5":"0.04405290","6":"1.424089e-03"},{"1":"PrevCM1","2":"1.2664419","3":"1.0868826","4":"1.475665","5":"0.07801047","6":"2.462238e-03"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Estimates are similar to 10% rule based approach <br> <br> <br> <br> <br> <br> <br></p>
</div>
</div>
</div>
<div id="changing-datasets-dhi-dataset-with-multiple-rows-per-cow" class="section level1">
<h1>Changing datasets: DHI dataset with multiple rows per cow</h1>
<p>Dataset example</p>
<pre class="r"><code>SDCTCOWDHI$Tx &lt;- 
  factor(SDCTCOWDHI$Tx, 
         levels=c(0,1,2),
         labels=c(&quot;Blanket&quot;,
                  &quot;Culture&quot;, 
                  &quot;Algorithm&quot;))

DHIcheck &lt;- SDCTCOWDHI %&gt;% select(Tx,CowID,FARMID,DIM,TestDIMcat20,LSCC,MY,Parity,PrevCM,DOMY,DOSCC)
head(DHIcheck, n=10)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Tx"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["CowID"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["FARMID"],"name":[3],"type":["chr"],"align":["left"]},{"label":["DIM"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["TestDIMcat20"],"name":[5],"type":["fctr"],"align":["left"]},{"label":["LSCC"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["MY"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Parity"],"name":[8],"type":["fctr"],"align":["left"]},{"label":["PrevCM"],"name":[9],"type":["fctr"],"align":["left"]},{"label":["DOMY"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["DOSCC"],"name":[11],"type":["dbl"],"align":["right"]}],"data":[{"1":"Algorithm","2":"6","3":"6","4":"28","5":"30","6":"2.890372","7":"57.60618","8":"1","9":"0","10":"32.65862","11":"3.988984"},{"1":"Algorithm","2":"6","3":"6","4":"56","5":"50","6":"3.465736","7":"54.88463","8":"1","9":"0","10":"32.65862","11":"3.988984"},{"1":"Algorithm","2":"6","3":"6","4":"91","5":"90","6":"3.178054","7":"56.69900","8":"1","9":"0","10":"32.65862","11":"3.988984"},{"1":"Algorithm","2":"6","3":"6","4":"119","5":"110","6":"3.583519","7":"48.08075","8":"1","9":"0","10":"32.65862","11":"3.988984"},{"1":"Algorithm","2":"7","3":"1","4":"19","5":"10","6":"6.893656","7":"29.48348","8":"3","9":"0","10":"34.01940","11":"6.198479"},{"1":"Algorithm","2":"7","3":"1","4":"54","5":"50","6":"6.270988","7":"43.54483","8":"3","9":"0","10":"34.01940","11":"6.198479"},{"1":"Culture","2":"7","3":"4","4":"16","5":"10","6":"0.000000","7":"42.63765","8":"2","9":"0","10":"46.71998","11":"3.850148"},{"1":"Culture","2":"7","3":"4","4":"44","5":"50","6":"3.465736","7":"49.44153","8":"2","9":"0","10":"46.71998","11":"3.850148"},{"1":"Culture","2":"7","3":"4","4":"72","5":"70","6":"4.762174","7":"48.08075","8":"2","9":"0","10":"46.71998","11":"3.850148"},{"1":"Culture","2":"7","3":"4","4":"107","5":"110","6":"4.804021","7":"46.71998","8":"2","9":"0","10":"46.71998","11":"3.850148"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br></p>
</div>
<div id="inspect-data-1" class="section level1">
<h1>Inspect data</h1>
<pre class="r"><code>DHIoutcome &lt;- SDCTCOWDHI %&gt;% select(SCC,MY,SCM)
DHIoutcome$logSCC &lt;- log(DHIoutcome$SCC + 1)
#summarytools::dfSummary(DHIoutcome, style=&#39;grid&#39;)
print(summarytools::dfSummary(DHIoutcome, valid.col=FALSE, graph.magnif=0.8, varnumbers=F, style=&quot;grid&quot;))</code></pre>
<pre><code>## Data Frame Summary  
##   
## Dimensions: 3992 x 4  
## Duplicates: 967  
## 
## +-----------+----------------------------+---------------------+------------------------+---------+
## | Variable  | Stats / Values             | Freqs (% of Valid)  | Graph                  | Missing |
## +===========+============================+=====================+========================+=========+
## | SCC       | Mean (sd) : 184.4 (678.2)  | 608 distinct values | :                      | 3       |
## | [numeric] | min &lt; med &lt; max:           |                     | :                      | (0.08%) |
## |           | 0 &lt; 39 &lt; 9999              |                     | :                      |         |
## |           | IQR (CV) : 89 (3.7)        |                     | :                      |         |
## |           |                            |                     | :                      |         |
## +-----------+----------------------------+---------------------+------------------------+---------+
## | MY        | Mean (sd) : 49.1 (10.5)    | 149 distinct values |         . :            | 2       |
## | [numeric] | min &lt; med &lt; max:           |                     |         : :            | (0.05%) |
## |           | 0.9 &lt; 49.4 &lt; 93.4          |                     |         : : :          |         |
## |           | IQR (CV) : 13.2 (0.2)      |                     |       . : : :          |         |
## |           |                            |                     |     . : : : : :        |         |
## +-----------+----------------------------+---------------------+------------------------+---------+
## | SCM       | Min  : 0                   | 0 : 3409 (85.5%)    | IIIIIIIIIIIIIIIII      | 3       |
## | [numeric] | Mean : 0.1                 | 1 :  580 (14.5%)    | II                     | (0.08%) |
## |           | Max  : 1                   |                     |                        |         |
## +-----------+----------------------------+---------------------+------------------------+---------+
## | logSCC    | Mean (sd) : 3.9 (1.4)      | 608 distinct values |       :                | 3       |
## | [numeric] | min &lt; med &lt; max:           |                     |       : .              | (0.08%) |
## |           | 0 &lt; 3.7 &lt; 9.2              |                     |     . : : .            |         |
## |           | IQR (CV) : 1.7 (0.3)       |                     |     : : : :            |         |
## |           |                            |                     |     : : : : : .        |         |
## +-----------+----------------------------+---------------------+------------------------+---------+</code></pre>
<p>Very little missing data. Will do complete case analysis. <br> <br> <br> <br></p>
<div id="assessing-normality-for-continuous-outcome-variables" class="section level2">
<h2>Assessing normality for continuous outcome variables</h2>
<p>Somatic cell count (log x 10,000 cells)</p>
<pre class="r"><code>library(qualityTools)
qqPlot(log(SDCTCOWDHI$SCC+1))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<pre class="r"><code>hist(log(SDCTCOWDHI$SCC+1))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-65-1.png" width="672" /> <br> <br> <br> <br> Milk yield (kg)</p>
<pre class="r"><code>qqPlot(SDCTCOWDHI$MY)</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<pre class="r"><code>hist(SDCTCOWDHI$MY)</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-67-1.png" width="672" /> <br> <br> <br> <br></p>
</div>
</div>
<div id="outcome-3-somatic-cell-count" class="section level1">
<h1>Outcome 3: Somatic cell count</h1>
<div id="modelling-plan" class="section level2">
<h2>Modelling plan</h2>
<p>Model type: Linear mixed models, random intercepts for farm and cow will be fitted to account for repeated measures within cows, and clustering of cows within herds</p>
<p>Step 1: Identify potential confouders using a directed acyclic graph (DAG)</p>
<p>Step 2: Identify correlated variables using pearson and kendalls correlation coefficients</p>
<p>Step 3: Create model with all potential confounders</p>
<p>Step 4: Investigate potential effect measure modification</p>
<p>Step 5: Remove unneccesary covariates in backwards stepwise fashion using 10% rule (i.e. if estimated difference in SCC changes by &gt;10% after removing the covariate, the covariate is retained in the model)</p>
<p>Step 6: Report final model</p>
<p>Step 7: Model diagnostics</p>
<div id="step-1-2-identify-potential-confounders-using-a-dag" class="section level3">
<h3>Step 1 &amp; 2 Identify potential confounders using a DAG</h3>
<pre class="r"><code>library(DiagrammeR)
mermaid(&quot;graph LR
        T(Treatment)--&gt;U(SCC)
        A(Age)--&gt;T
        P(Parity)--&gt;T
        M(Yield at dry-off)--&gt;T
        S(SCC during prev lactation)--&gt;T
        C(CM in prev lact)--&gt;T
        D(Days in milk at test)--&gt;U
        D--&gt;T
        A--&gt;U
        P--&gt;U
        M--&gt;U
        S--&gt;U
        C--&gt;U
        C--&gt;M
        P--&gt;C
        P--&gt;S
        P--&gt;M
        A--&gt;P
        A--&gt;C
        A--&gt;S
        A--&gt;M
        M--&gt;S
        C--&gt;S
        style A fill:#FFFFFF, stroke-width:0px
        style T fill:#FFFFFF, stroke-width:2px
        style P fill:#FFFFFF, stroke-width:0px
        style M fill:#FFFFFF, stroke-width:0px
        style S fill:#FFFFFF, stroke-width:0px
        style C fill:#FFFFFF, stroke-width:0px
        style I fill:#FFFFFF, stroke-width:0px
        style D fill:#FFFFFF, stroke-width:0px
        style U fill:#FFFFFF, stroke-width:2px
        &quot;)</code></pre>
<p><div id="htmlwidget-cdefb7ac945c0032ee8b" style="width:960px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-cdefb7ac945c0032ee8b">{"x":{"diagram":"graph LR\n        T(Treatment)-->U(SCC)\n        A(Age)-->T\n        P(Parity)-->T\n        M(Yield at dry-off)-->T\n        S(SCC during prev lactation)-->T\n        C(CM in prev lact)-->T\n        D(Days in milk at test)-->U\n        D-->T\n        A-->U\n        P-->U\n        M-->U\n        S-->U\n        C-->U\n        C-->M\n        P-->C\n        P-->S\n        P-->M\n        A-->P\n        A-->C\n        A-->S\n        A-->M\n        M-->S\n        C-->S\n        style A fill:#FFFFFF, stroke-width:0px\n        style T fill:#FFFFFF, stroke-width:2px\n        style P fill:#FFFFFF, stroke-width:0px\n        style M fill:#FFFFFF, stroke-width:0px\n        style S fill:#FFFFFF, stroke-width:0px\n        style C fill:#FFFFFF, stroke-width:0px\n        style I fill:#FFFFFF, stroke-width:0px\n        style D fill:#FFFFFF, stroke-width:0px\n        style U fill:#FFFFFF, stroke-width:2px\n        "},"evals":[],"jsHooks":[]}</script> According to this DAG, I may need to control for the following variables:</p>
<p>Parity [“Parity”] &lt;- Age not offered as highly correlated</p>
<p>Yield at most recent test before dry off [“DOMY”]</p>
<p>Somatic cell count at last herd test during previous lactation [“DOSCC”] &lt;- PrevSCCHI not offered as correlated</p>
<p>Clinical mastitis in previous lactation [“PrevCM”]</p>
<p>Days in milk at herd test (category, 0-20 “10”, 21-40 “30” etc) [“TestDIMcat20”]</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-3-create-model-with-all-potential-confounders-1" class="section level3">
<h3>Step 3: Create model with all potential confounders</h3>
<pre class="r"><code>library(lme4)
mm0 &lt;- lmer(LSCC ~ Tx + TestDIMcat20 + Parity + DOSCC + DOMY + PrevCM + (1|FARMID/CowID), data=SDCTCOWDHI)
summary(mm0)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: LSCC ~ Tx + TestDIMcat20 + Parity + DOSCC + DOMY + PrevCM + (1 |  
##     FARMID/CowID)
##    Data: SDCTCOWDHI
## 
## REML criterion at convergence: 13110.3
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -5.5975 -0.4985 -0.1040  0.4340  3.9735 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev.
##  CowID:FARMID (Intercept) 0.61791  0.7861  
##  FARMID       (Intercept) 0.02027  0.1424  
##  Residual                 1.14078  1.0681  
## Number of obs: 3989, groups:  CowID:FARMID, 1178; FARMID, 7
## 
## Fixed effects:
##                  Estimate Std. Error t value
## (Intercept)      3.338254   0.204372  16.334
## TxCulture        0.047878   0.070138   0.683
## TxAlgorithm      0.074745   0.070822   1.055
## TestDIMcat2030  -0.576961   0.063393  -9.101
## TestDIMcat2050  -0.557223   0.060950  -9.142
## TestDIMcat2070  -0.394721   0.059969  -6.582
## TestDIMcat2090  -0.272158   0.065089  -4.181
## TestDIMcat20110 -0.084757   0.060209  -1.408
## Parity2          0.110743   0.070611   1.568
## Parity3          0.259957   0.074986   3.467
## DOSCC            0.139922   0.028350   4.935
## DOMY             0.002402   0.003983   0.603
## PrevCM1          0.361076   0.087707   4.117</code></pre>
<pre class="r"><code>car::vif(mm0)</code></pre>
<pre><code>##                  GVIF Df GVIF^(1/(2*Df))
## Tx           1.009521  2        1.002372
## TestDIMcat20 1.003238  5        1.000323
## Parity       1.141466  2        1.033631
## DOSCC        1.319455  1        1.148676
## DOMY         1.167395  1        1.080461
## PrevCM       1.050427  1        1.024903</code></pre>
<p><br> <br> <br> <br></p>
</div>
<div id="step-4-investigate-effect-measure-modification" class="section level3">
<h3>Step 4: Investigate effect measure modification</h3>
<p>Tx:FARM (P &gt; 0.05)</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx*FARMID + Parity + TestDIMcat20 + DOSCC + DOMY + PrevCM + (1|CowID), data=SDCTCOWDHI)
car::Anova(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"0.3270357","2":"2","3":"8.491513e-01","_rn_":"Tx"},{"1":"20.8837267","2":"6","3":"1.924973e-03","_rn_":"FARMID"},{"1":"10.7805111","2":"2","3":"4.560808e-03","_rn_":"Parity"},{"1":"153.2866279","2":"5","3":"2.665499e-31","_rn_":"TestDIMcat20"},{"1":"23.5900140","2":"1","3":"1.192045e-06","_rn_":"DOSCC"},{"1":"0.1510590","2":"1","3":"6.975254e-01","_rn_":"DOMY"},{"1":"16.3380680","2":"1","3":"5.298873e-05","_rn_":"PrevCM"},{"1":"13.6784831","2":"12","3":"3.217092e-01","_rn_":"Tx:FARMID"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br></p>
<p>Tx:DIM category at herd test (P &gt; 0.05)</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx*TestDIMcat20 + Parity + DOSCC + DOMY + PrevCM + (1|FARMID/CowID), data=SDCTCOWDHI)
car::Anova(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1.1452212","2":"2","3":"5.640510e-01","_rn_":"Tx"},{"1":"155.5912003","2":"5","3":"8.608808e-32","_rn_":"TestDIMcat20"},{"1":"12.0312701","2":"2","3":"2.440298e-03","_rn_":"Parity"},{"1":"24.5070671","2":"1","3":"7.403778e-07","_rn_":"DOSCC"},{"1":"0.3514114","2":"1","3":"5.533153e-01","_rn_":"DOMY"},{"1":"16.9004697","2":"1","3":"3.939183e-05","_rn_":"PrevCM"},{"1":"3.6320382","2":"10","3":"9.624238e-01","_rn_":"Tx:TestDIMcat20"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> Tx:Parity (P &gt; 0.05)</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx*Parity + TestDIMcat20 + DOSCC + DOMY + PrevCM + (1|FARMID/CowID), data=SDCTCOWDHI)
car::Anova(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1.1474124","2":"2","3":"5.634334e-01","_rn_":"Tx"},{"1":"12.0289322","2":"2","3":"2.443152e-03","_rn_":"Parity"},{"1":"155.4765341","2":"5","3":"9.106853e-32","_rn_":"TestDIMcat20"},{"1":"25.0949142","2":"1","3":"5.457661e-07","_rn_":"DOSCC"},{"1":"0.4870673","2":"1","3":"4.852384e-01","_rn_":"DOMY"},{"1":"16.3909369","2":"1","3":"5.153104e-05","_rn_":"PrevCM"},{"1":"5.3324698","2":"4","3":"2.548527e-01","_rn_":"Tx:Parity"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> Tx:PrevCM (P &gt; 0.05)</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx*PrevCM + Parity + TestDIMcat20 + DOSCC + DOMY + (1|FARMID/CowID), data=SDCTCOWDHI)
car::Anova(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1.1470027","2":"2","3":"5.635488e-01","_rn_":"Tx"},{"1":"16.9457329","2":"1","3":"3.846368e-05","_rn_":"PrevCM"},{"1":"12.3024121","2":"2","3":"2.130910e-03","_rn_":"Parity"},{"1":"155.7581044","2":"5","3":"7.932129e-32","_rn_":"TestDIMcat20"},{"1":"23.9344930","2":"1","3":"9.966988e-07","_rn_":"DOSCC"},{"1":"0.2841106","2":"1","3":"5.940196e-01","_rn_":"DOMY"},{"1":"1.1794576","2":"2","3":"5.544776e-01","_rn_":"Tx:PrevCM"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> Tx:DOMY (P &gt; 0.05)</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx*DOMY + PrevCM + Parity + TestDIMcat20 + DOSCC + (1|FARMID/CowID), data=SDCTCOWDHI)
car::Anova(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1.1480925","2":"2","3":"5.632418e-01","_rn_":"Tx"},{"1":"0.3579578","2":"1","3":"5.496426e-01","_rn_":"DOMY"},{"1":"17.4500069","2":"1","3":"2.949632e-05","_rn_":"PrevCM"},{"1":"11.7208099","2":"2","3":"2.850089e-03","_rn_":"Parity"},{"1":"155.5512526","2":"5","3":"8.779149e-32","_rn_":"TestDIMcat20"},{"1":"24.5607406","2":"1","3":"7.200387e-07","_rn_":"DOSCC"},{"1":"3.2737811","2":"2","3":"1.945842e-01","_rn_":"Tx:DOMY"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="step-5-remove-unneccesary-covariates-in-backwards-stepwise-fashion-using-10-rule" class="section level3">
<h3>Step 5: Remove unneccesary covariates in backwards stepwise fashion using 10% rule</h3>
<p>The order for removing covariates will be in increasing likelihood of being a confounder, which is based on my knowledge about the variables and their distribution in treatment groups.</p>
<p>This order will be: DOMY, Parity, PrevCM, DOSCC</p>
<p>TestDIMcat20 will not be removed.</p>
<p>Step 5a: Full model</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx + PrevCM + Parity + TestDIMcat20 + DOSCC + DOMY + (1|FARMID/CowID), data=SDCTCOWDHI)
mm0 %&gt;% tidy()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"3.33825425","3":"0.204372362","4":"16.3341766","5":"fixed"},{"1":"TxCulture","2":"0.04787831","3":"0.070138475","4":"0.6826255","5":"fixed"},{"1":"TxAlgorithm","2":"0.07474503","3":"0.070821895","4":"1.0553944","5":"fixed"},{"1":"PrevCM1","2":"0.36107605","3":"0.087707375","4":"4.1168266","5":"fixed"},{"1":"Parity2","2":"0.11074271","3":"0.070610791","4":"1.5683540","5":"fixed"},{"1":"Parity3","2":"0.25995719","3":"0.074986122","4":"3.4667374","5":"fixed"},{"1":"TestDIMcat2030","2":"-0.57696070","3":"0.063392861","4":"-9.1013513","5":"fixed"},{"1":"TestDIMcat2050","2":"-0.55722310","3":"0.060950242","4":"-9.1422623","5":"fixed"},{"1":"TestDIMcat2070","2":"-0.39472150","3":"0.059968641","4":"-6.5821318","5":"fixed"},{"1":"TestDIMcat2090","2":"-0.27215816","3":"0.065088652","4":"-4.1813458","5":"fixed"},{"1":"TestDIMcat20110","2":"-0.08475659","3":"0.060208946","4":"-1.4077075","5":"fixed"},{"1":"DOSCC","2":"0.13992193","3":"0.028350264","4":"4.9354718","5":"fixed"},{"1":"DOMY","2":"0.00240247","3":"0.003982987","4":"0.6031830","5":"fixed"},{"1":"sd_(Intercept).CowID:FARMID","2":"0.78607504","3":"NA","4":"NA","5":"CowID:FARMID"},{"1":"sd_(Intercept).FARMID","2":"0.14238820","3":"NA","4":"NA","5":"FARMID"},{"1":"sd_Observation.Residual","2":"1.06807085","3":"NA","4":"NA","5":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> Step 5b: removing DOMY</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx + PrevCM + Parity + TestDIMcat20 + DOSCC + (1|FARMID/CowID), data=SDCTCOWDHI) 
mm0%&gt;% tidy()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"3.42859000","3":"0.13777833","4":"24.8848280","5":"fixed"},{"1":"TxCulture","2":"0.05036680","3":"0.07001580","4":"0.7193634","5":"fixed"},{"1":"TxAlgorithm","2":"0.07606931","3":"0.07078603","4":"1.0746374","5":"fixed"},{"1":"PrevCM1","2":"0.36481995","3":"0.08748408","4":"4.1701297","5":"fixed"},{"1":"Parity2","2":"0.11135249","3":"0.07057698","4":"1.5777451","5":"fixed"},{"1":"Parity3","2":"0.26039469","3":"0.07495928","4":"3.4738154","5":"fixed"},{"1":"TestDIMcat2030","2":"-0.57728582","3":"0.06338652","4":"-9.1073917","5":"fixed"},{"1":"TestDIMcat2050","2":"-0.55721744","3":"0.06094907","4":"-9.1423453","5":"fixed"},{"1":"TestDIMcat2070","2":"-0.39466902","3":"0.05996741","4":"-6.5813918","5":"fixed"},{"1":"TestDIMcat2090","2":"-0.27284529","3":"0.06507872","4":"-4.1925423","5":"fixed"},{"1":"TestDIMcat20110","2":"-0.08424553","3":"0.06020094","4":"-1.3994055","5":"fixed"},{"1":"DOSCC","2":"0.13401404","3":"0.02642466","4":"5.0715519","5":"fixed"},{"1":"sd_(Intercept).CowID:FARMID","2":"0.78599144","3":"NA","4":"NA","5":"CowID:FARMID"},{"1":"sd_(Intercept).FARMID","2":"0.13506559","3":"NA","4":"NA","5":"FARMID"},{"1":"sd_Observation.Residual","2":"1.06806235","3":"NA","4":"NA","5":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%. DOMY stays out. <br> <br> <br> <br> Step 5b: removing Parity</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx + PrevCM + TestDIMcat20 + DOSCC + (1|FARMID/CowID), data=SDCTCOWDHI)
mm0 %&gt;% tidy()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"3.41134493","3":"0.13793380","4":"24.7317547","5":"fixed"},{"1":"TxCulture","2":"0.04720495","3":"0.07022619","4":"0.6721845","5":"fixed"},{"1":"TxAlgorithm","2":"0.07150148","3":"0.07108489","4":"1.0058605","5":"fixed"},{"1":"PrevCM1","2":"0.39532686","3":"0.08744017","4":"4.5211124","5":"fixed"},{"1":"TestDIMcat2030","2":"-0.57452627","3":"0.06340321","4":"-9.0614701","5":"fixed"},{"1":"TestDIMcat2050","2":"-0.55888149","3":"0.06095651","4":"-9.1685288","5":"fixed"},{"1":"TestDIMcat2070","2":"-0.39303438","3":"0.05997577","4":"-6.5532190","5":"fixed"},{"1":"TestDIMcat2090","2":"-0.27577822","3":"0.06509397","4":"-4.2366173","5":"fixed"},{"1":"TestDIMcat20110","2":"-0.08406787","3":"0.06020818","4":"-1.3962866","5":"fixed"},{"1":"DOSCC","2":"0.16126140","3":"0.02520920","4":"6.3969276","5":"fixed"},{"1":"sd_(Intercept).CowID:FARMID","2":"0.79151591","3":"NA","4":"NA","5":"CowID:FARMID"},{"1":"sd_(Intercept).FARMID","2":"0.13541971","3":"NA","4":"NA","5":"FARMID"},{"1":"sd_Observation.Residual","2":"1.06798859","3":"NA","4":"NA","5":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%. Parity stays out.</p>
<p><br> <br> <br> <br> Step 5c: removing PrevCM</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx + TestDIMcat20 + DOSCC + (1|FARMID/CowID), data=SDCTCOWDHI) 
mm0 %&gt;% tidy()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"3.36795696","3":"0.13958282","4":"24.1287360","5":"fixed"},{"1":"TxCulture","2":"0.05307791","3":"0.07073922","4":"0.7503321","5":"fixed"},{"1":"TxAlgorithm","2":"0.06712728","3":"0.07160816","4":"0.9374250","5":"fixed"},{"1":"TestDIMcat2030","2":"-0.57760503","3":"0.06346540","4":"-9.1011005","5":"fixed"},{"1":"TestDIMcat2050","2":"-0.55965219","3":"0.06099586","4":"-9.1752486","5":"fixed"},{"1":"TestDIMcat2070","2":"-0.39324305","3":"0.06001684","4":"-6.5522122","5":"fixed"},{"1":"TestDIMcat2090","2":"-0.27901647","3":"0.06514956","4":"-4.2827072","5":"fixed"},{"1":"TestDIMcat20110","2":"-0.08430661","3":"0.06024642","4":"-1.3993631","5":"fixed"},{"1":"DOSCC","2":"0.18192084","3":"0.02499702","4":"7.2777024","5":"fixed"},{"1":"sd_(Intercept).CowID:FARMID","2":"0.80048400","3":"NA","4":"NA","5":"CowID:FARMID"},{"1":"sd_(Intercept).FARMID","2":"0.14290252","3":"NA","4":"NA","5":"FARMID"},{"1":"sd_Observation.Residual","2":"1.06830771","3":"NA","4":"NA","5":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &gt;10%. PrevCM stays in. <br> <br> <br> <br> Step 5d: removing DOSCC</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx + PrevCM + TestDIMcat20 + (1|FARMID/CowID), data=SDCTCOWDHI)
mm0 %&gt;% tidy()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[5],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"4.10486589","3":"0.09487243","4":"43.2672135","5":"fixed"},{"1":"TxCulture","2":"0.03051519","3":"0.07140614","4":"0.4273469","5":"fixed"},{"1":"TxAlgorithm","2":"0.06857559","3":"0.07232705","4":"0.9481320","5":"fixed"},{"1":"PrevCM1","2":"0.49580836","3":"0.08756598","4":"5.6621117","5":"fixed"},{"1":"TestDIMcat2030","2":"-0.57039554","3":"0.06347950","4":"-8.9855079","5":"fixed"},{"1":"TestDIMcat2050","2":"-0.56185981","3":"0.06097229","4":"-9.2150019","5":"fixed"},{"1":"TestDIMcat2070","2":"-0.39337524","3":"0.05999882","4":"-6.5563831","5":"fixed"},{"1":"TestDIMcat2090","2":"-0.27166327","3":"0.06515527","4":"-4.1694751","5":"fixed"},{"1":"TestDIMcat20110","2":"-0.08685553","3":"0.06022372","4":"-1.4422147","5":"fixed"},{"1":"sd_(Intercept).CowID:FARMID","2":"0.81300756","3":"NA","4":"NA","5":"CowID:FARMID"},{"1":"sd_(Intercept).FARMID","2":"0.17413095","3":"NA","4":"NA","5":"FARMID"},{"1":"sd_Observation.Residual","2":"1.06735392","3":"NA","4":"NA","5":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &gt; 10%. DOSCC stays in. <br> <br> <br> <br></p>
</div>
<div id="step-6a-final-model-for-scc-1---120-dim" class="section level3">
<h3>Step 6a: Final model for SCC (1 - 120 DIM)</h3>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx + PrevCM + DOSCC + TestDIMcat20 + (1|FARMID/CowID), data=SDCTCOWDHI)
mm0 %&gt;% tidy(conf.int=TRUE)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"3.41134493","3":"0.13793380","4":"24.7317547","5":"3.14099965","6":"3.68169021","7":"fixed"},{"1":"TxCulture","2":"0.04720495","3":"0.07022619","4":"0.6721845","5":"-0.09043584","6":"0.18484575","7":"fixed"},{"1":"TxAlgorithm","2":"0.07150148","3":"0.07108489","4":"1.0058605","5":"-0.06782234","6":"0.21082530","7":"fixed"},{"1":"PrevCM1","2":"0.39532686","3":"0.08744017","4":"4.5211124","5":"0.22394727","6":"0.56670645","7":"fixed"},{"1":"DOSCC","2":"0.16126140","3":"0.02520920","4":"6.3969276","5":"0.11185229","6":"0.21067052","7":"fixed"},{"1":"TestDIMcat2030","2":"-0.57452627","3":"0.06340321","4":"-9.0614701","5":"-0.69879428","6":"-0.45025827","7":"fixed"},{"1":"TestDIMcat2050","2":"-0.55888149","3":"0.06095651","4":"-9.1685288","5":"-0.67835405","6":"-0.43940893","7":"fixed"},{"1":"TestDIMcat2070","2":"-0.39303438","3":"0.05997577","4":"-6.5532190","5":"-0.51058474","6":"-0.27548402","7":"fixed"},{"1":"TestDIMcat2090","2":"-0.27577822","3":"0.06509397","4":"-4.2366173","5":"-0.40336005","6":"-0.14819639","7":"fixed"},{"1":"TestDIMcat20110","2":"-0.08406787","3":"0.06020818","4":"-1.3962866","5":"-0.20207374","6":"0.03393799","7":"fixed"},{"1":"sd_(Intercept).CowID:FARMID","2":"0.79151591","3":"NA","4":"NA","5":"NA","6":"NA","7":"CowID:FARMID"},{"1":"sd_(Intercept).FARMID","2":"0.13541971","3":"NA","4":"NA","5":"NA","6":"NA","7":"FARMID"},{"1":"sd_Observation.Residual","2":"1.06798859","3":"NA","4":"NA","5":"NA","6":"NA","7":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="icc-for-scc-1---120-dim" class="section level4">
<h4>ICC for SCC (1 - 120 DIM)</h4>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ 1 + (1|FARMID/CowID), data=SDCTCOWDHI)
summary(mm0)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: LSCC ~ 1 + (1 | FARMID/CowID)
##    Data: SDCTCOWDHI
## 
## REML criterion at convergence: 13293.7
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -5.0159 -0.5107 -0.1062  0.4452  4.0999 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev.
##  CowID:FARMID (Intercept) 0.65871  0.8116  
##  FARMID       (Intercept) 0.03917  0.1979  
##  Residual                 1.20343  1.0970  
## Number of obs: 3989, groups:  CowID:FARMID, 1178; FARMID, 7
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  3.86908    0.08308   46.57</code></pre>
<p>ICC (CowID) = 0.35 ICC (FARMID) = 0.02</p>
<p>Most clustering is happening within cow (repeated measures).</p>
</div>
</div>
<div id="step-6b-final-model-for-scc-1---120-dim-using-p-value-based-backwards-selection" class="section level3">
<h3>Step 6b: Final model for SCC (1 - 120 DIM) using P-value based backwards selection</h3>
<pre class="r"><code>lmer(LSCC ~ Tx + Parity + PrevCM + DOSCC + (1|FARMID/CowID), data=SDCTCOWDHI) %&gt;% summary()</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: LSCC ~ Tx + Parity + PrevCM + DOSCC + (1 | FARMID/CowID)
##    Data: SDCTCOWDHI
## 
## REML criterion at convergence: 13233.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -5.1671 -0.5100 -0.1122  0.4512  4.1458 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev.
##  CowID:FARMID (Intercept) 0.59501  0.7714  
##  FARMID       (Intercept) 0.01825  0.1351  
##  Residual                 1.20377  1.0972  
## Number of obs: 3989, groups:  CowID:FARMID, 1178; FARMID, 7
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  3.12018    0.13160  23.710
## TxCulture    0.04063    0.06986   0.582
## TxAlgorithm  0.06227    0.07063   0.882
## Parity2      0.11211    0.07042   1.592
## Parity3      0.25300    0.07477   3.384
## PrevCM1      0.37041    0.08730   4.243
## DOSCC        0.13267    0.02635   5.035
## 
## Correlation of Fixed Effects:
##             (Intr) TxCltr TxAlgr Party2 Party3 PrvCM1
## TxCulture   -0.298                                   
## TxAlgorithm -0.270  0.498                            
## Parity2     -0.042  0.054  0.021                     
## Parity3      0.038  0.012  0.019  0.439              
## PrevCM1      0.069 -0.019  0.013 -0.044 -0.100       
## DOSCC       -0.786  0.026  0.000 -0.223 -0.295 -0.143</code></pre>
<pre class="r"><code>lmer(LSCC ~ Tx + Parity + PrevCM + DOSCC + (1|FARMID/CowID), data=SDCTCOWDHI) %&gt;% car::Anova() %&gt;% tidy()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["statistic"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["p.value"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Tx","2":"0.8042336","3":"2","4":"6.689026e-01"},{"1":"Parity","2":"11.4642820","3":"2","4":"3.240133e-03"},{"1":"PrevCM","2":"18.0027412","3":"1","4":"2.205871e-05"},{"1":"DOSCC","2":"25.3499164","3":"1","4":"4.781731e-07"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Estimates are very similar to 10% rule based approach. <br> <br> <br> <br></p>
</div>
<div id="step-6c-final-model-using-10-rule-reported-as-estimated-marginal-means-lsmeans" class="section level3">
<h3>Step 6c: Final model (using 10% rule) reported as estimated marginal means (~LSmeans)</h3>
<p>Mean log SCC</p>
<pre class="r"><code>library(emmeans)
mm0 &lt;- lmer(LSCC ~ Tx + PrevCM + DOSCC + TestDIMcat20 + (1|FARMID/CowID), data=SDCTCOWDHI)
emm &lt;- emmeans(mm0, ~Tx) %&gt;% tidy()
emm</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Tx"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["asymp.LCL"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["asymp.UCL"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"Blanket","2":"4.008546","3":"0.08079219","4":"Inf","5":"3.850196","6":"4.166896"},{"1":"Culture","2":"4.055751","3":"0.08025239","4":"Inf","5":"3.898459","6":"4.213043"},{"1":"Algorithm","2":"4.080047","3":"0.08189377","4":"Inf","5":"3.919538","6":"4.240556"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="step-6c-final-model-using-10-rule-reported-as-back-transformed-estimated-marginal-means-lsmeans" class="section level3">
<h3>Step 6c: Final model (using 10% rule) reported as back-transformed estimated marginal means (~LSmeans)</h3>
<p>Geometric mean SCC</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx + PrevCM + DOSCC + TestDIMcat20 + (1|FARMID/CowID), data=SDCTCOWDHI)
emm &lt;- emmeans(mm0, ~Tx) %&gt;% tidy()
emm$SCC &lt;- exp(emm$estimate) 
emm$LCL &lt;- exp(emm$asymp.LCL)
emm$UCL &lt;- exp(emm$asymp.UCL)
emm &lt;- emm %&gt;% subset(select=c(Tx,SCC,LCL,UCL))
emm</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Tx"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["SCC"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["LCL"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["UCL"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Blanket","2":"55.06674","3":"47.00228","4":"64.51486"},{"1":"Culture","2":"57.72849","3":"49.32638","4":"67.56179"},{"1":"Algorithm","2":"59.14827","3":"50.37719","4":"69.44646"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br></p>
<p>Reported as back-transformed estimated marginal means by herd test day, no interaction with test DIM</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx + TestDIMcat20 + DOSCC + PrevCM + (1|FARMID/CowID), data=SDCTCOWDHI)
atx &lt;- c(10,30,50,70,90,110)
emm &lt;- emmeans(mm0, ~Tx*TestDIMcat20, at=list(atx)) %&gt;% tidy()
emm$SCC &lt;- exp(emm$estimate)
emm$LCL &lt;- exp(emm$asymp.LCL)
emm$UCL &lt;- exp(emm$asymp.UCL)
emm &lt;- emm %&gt;% subset(select=c(Tx,TestDIMcat20,SCC,LCL,UCL))
curve &lt;- ggplot(emm) + coord_cartesian(ylim = (c(0,100))) + aes(x=TestDIMcat20, y=SCC, group=Tx, colour=Tx) + geom_point() + geom_line(aes(colour=Tx,linetype=Tx)) + geom_ribbon(aes(ymin=emm$LCL, ymax=emm$UCL,colour=Tx,fill=Tx), linetype=0, alpha=0.1)
curve</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-84-1.png" width="672" /> <br> <br> <br> <br></p>
<p>Reported as back-transformed estimated marginal means by herd test day, with interaction with test DIM</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx*TestDIMcat20 + PrevCM + DOSCC + (1|FARMID/CowID), data=SDCTCOWDHI)
atx &lt;- c(10,30,50,70,90,110)
emm &lt;- emmeans(mm0, ~Tx*TestDIMcat20, at=list(atx)) %&gt;% tidy()
emm$SCC &lt;- exp(emm$estimate)
emm$LCL &lt;- exp(emm$asymp.LCL)
emm$UCL &lt;- exp(emm$asymp.UCL)
emm &lt;- emm %&gt;% subset(select=c(Tx,TestDIMcat20,SCC,LCL,UCL))
curve &lt;- ggplot(emm) + coord_cartesian(ylim = (c(0,100))) + aes(x=TestDIMcat20, y=SCC, group=Tx, colour=Tx) + geom_point() + geom_line(aes(colour=Tx,linetype=Tx)) + geom_ribbon(aes(ymin=emm$LCL, ymax=emm$UCL,colour=Tx,fill=Tx), linetype=0, alpha=0.1)
curve</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-85-1.png" width="672" /> <br> <br> <br> <br></p>
</div>
<div id="step-7-model-diagnostics" class="section level3">
<h3>Step 7: Model diagnostics</h3>
<p>Checking homoskedasticity assumption (variance of residuals)</p>
<pre class="r"><code>mm0 &lt;- lmer(LSCC ~ Tx + TestDIMcat20 + (1|FARMID/CowID), data=SDCTCOWDHI)
ggplot(data.frame(eta=predict(mm0,type=&quot;link&quot;),pearson=residuals(mm0,type=&quot;pearson&quot;)),
       aes(x=eta,y=pearson)) +
  geom_point() +
  theme_bw()</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-86-1.png" width="672" /></p>
<p>Checking normality of residuals</p>
<pre class="r"><code>qqnorm(residuals(mm0))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<p>Evidence of small L tail. Although some evidence of heteroskedasticity and not perfectly normal residuals, I believe these are allowable for this model.</p>
</div>
</div>
</div>
<div id="outcome-4-milk-yield" class="section level1">
<h1>Outcome 4: Milk yield</h1>
<div id="modelling-plan-1" class="section level2">
<h2>Modelling plan</h2>
<p>Model type: Linear mixed models, random intercepts for farm and cow will be fitted to account for repeated measures within cows, and clustering of cows within herds</p>
<p>Step 1: Identify potential confouders using a directed acyclic graph (DAG)</p>
<p>Step 2: Identify correlated variables using pearson and kendalls correlation coefficients</p>
<p>Step 3: Create model with all potential confounders</p>
<p>Step 4: Investigate potential effect measure modification</p>
<p>Step 5: Remove unneccesary covariates in backwards stepwise fashion using 10% rule (i.e. if estimated difference in milk yield changes by &gt;10% after removing the covariate, the covariate is retained in the model)</p>
<p>Step 6: Report final model</p>
<p>Step 7: Model diagnostics</p>
<div id="step-1-2-identify-potential-confounders-using-a-dag-1" class="section level3">
<h3>Step 1 &amp; 2 Identify potential confounders using a DAG</h3>
<pre class="r"><code>library(DiagrammeR)
mermaid(&quot;graph LR
        T(Treatment)--&gt;U(Milk yield)
        A(Age)--&gt;T
        P(Parity)--&gt;T
        M(Yield at dry-off)--&gt;T
        S(SCC during prev lactation)--&gt;T
        C(CM in prev lact)--&gt;T
        D(Days in milk at test)--&gt;U
        D--&gt;T
        A--&gt;U
        P--&gt;U
        M--&gt;U
        S--&gt;U
        C--&gt;U
        C--&gt;M
        P--&gt;C
        P--&gt;S
        P--&gt;M
        A--&gt;P
        A--&gt;C
        A--&gt;S
        A--&gt;M
        M--&gt;S
        C--&gt;S
        style A fill:#FFFFFF, stroke-width:0px
        style T fill:#FFFFFF, stroke-width:2px
        style P fill:#FFFFFF, stroke-width:0px
        style M fill:#FFFFFF, stroke-width:0px
        style S fill:#FFFFFF, stroke-width:0px
        style C fill:#FFFFFF, stroke-width:0px
        style I fill:#FFFFFF, stroke-width:0px
        style D fill:#FFFFFF, stroke-width:0px
        style U fill:#FFFFFF, stroke-width:2px
        &quot;)</code></pre>
<p><div id="htmlwidget-70f08ffd872c7b913f4e" style="width:960px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-70f08ffd872c7b913f4e">{"x":{"diagram":"graph LR\n        T(Treatment)-->U(Milk yield)\n        A(Age)-->T\n        P(Parity)-->T\n        M(Yield at dry-off)-->T\n        S(SCC during prev lactation)-->T\n        C(CM in prev lact)-->T\n        D(Days in milk at test)-->U\n        D-->T\n        A-->U\n        P-->U\n        M-->U\n        S-->U\n        C-->U\n        C-->M\n        P-->C\n        P-->S\n        P-->M\n        A-->P\n        A-->C\n        A-->S\n        A-->M\n        M-->S\n        C-->S\n        style A fill:#FFFFFF, stroke-width:0px\n        style T fill:#FFFFFF, stroke-width:2px\n        style P fill:#FFFFFF, stroke-width:0px\n        style M fill:#FFFFFF, stroke-width:0px\n        style S fill:#FFFFFF, stroke-width:0px\n        style C fill:#FFFFFF, stroke-width:0px\n        style I fill:#FFFFFF, stroke-width:0px\n        style D fill:#FFFFFF, stroke-width:0px\n        style U fill:#FFFFFF, stroke-width:2px\n        "},"evals":[],"jsHooks":[]}</script> According to this DAG, I may need to control for the following variables:</p>
<p>Parity [“Parity”] &lt;- Age not offered as highly correlated</p>
<p>Yield at most recent test before dry off [“DOMY”]</p>
<p>Somatic cell count at last herd test during previous lactation [“DOSCC”] &lt;- PrevSCCHI not offered as correlated</p>
<p>Clinical mastitis in previous lactation [“PrevCM”]</p>
<p>Days in milk at herd test (category, 0-20 “10”, 21-40 “30” etc) [“TestDIMcat20”]</p>
<p><br> <br> <br> <br></p>
</div>
<div id="step-3-create-a-model-with-all-potential-covariates" class="section level3">
<h3>Step 3: Create a model with all potential covariates</h3>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + TestDIMcat20 + Parity + DOSCC + PrevCM + DOMY + (1|FARMID/CowID), data=SDCTCOWDHI)
summary(mm0)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: MY ~ Tx + TestDIMcat20 + Parity + DOSCC + PrevCM + DOMY + (1 |  
##     FARMID/CowID)
##    Data: SDCTCOWDHI
## 
## REML criterion at convergence: 27948.5
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -6.3698 -0.4620  0.0223  0.5283  3.9851 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev.
##  CowID:FARMID (Intercept) 28.70    5.357   
##  FARMID       (Intercept)  9.63    3.103   
##  Residual                 46.18    6.795   
## Number of obs: 3990, groups:  CowID:FARMID, 1177; FARMID, 7
## 
## Fixed effects:
##                 Estimate Std. Error t value
## (Intercept)     30.22473    1.76719  17.103
## TxCulture       -0.04144    0.46718  -0.089
## TxAlgorithm     -0.92795    0.47146  -1.968
## TestDIMcat2030  11.86182    0.40548  29.253
## TestDIMcat2050  12.87916    0.38854  33.148
## TestDIMcat2070  12.51208    0.38249  32.713
## TestDIMcat2090  11.01316    0.41572  26.492
## TestDIMcat20110  8.43431    0.38401  21.964
## Parity2          2.52549    0.47112   5.361
## Parity3          3.01851    0.50067   6.029
## DOSCC            0.26481    0.19029   1.392
## PrevCM1         -0.24232    0.58620  -0.413
## DOMY             0.22068    0.02706   8.156</code></pre>
<pre class="r"><code>car::vif(mm0)</code></pre>
<pre><code>##                  GVIF Df GVIF^(1/(2*Df))
## Tx           1.009493  2        1.002365
## TestDIMcat20 1.002987  5        1.000298
## Parity       1.145893  2        1.034632
## DOSCC        1.308164  1        1.143750
## PrevCM       1.048252  1        1.023842
## DOMY         1.154875  1        1.074651</code></pre>
<p><br> <br> <br> <br></p>
</div>
<div id="step-4-investigate-effect-measure-modification-1" class="section level3">
<h3>Step 4: Investigate effect measure modification</h3>
</div>
<div id="txfarm-p-0.05" class="section level3">
<h3>Tx:FARM (P &lt; 0.05)</h3>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx*FARMID + Parity + TestDIMcat20 + DOSCC + DOMY + PrevCM + (1|CowID), data=SDCTCOWDHI)
car::Anova(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"7.191899","2":"2","3":"2.743462e-02","_rn_":"Tx"},{"1":"383.170077","2":"6","3":"1.158516e-79","_rn_":"FARMID"},{"1":"56.094098","2":"2","3":"6.596618e-13","_rn_":"Parity"},{"1":"1502.406200","2":"5","3":"8.893182e-323","_rn_":"TestDIMcat20"},{"1":"1.838381","2":"1","3":"1.751408e-01","_rn_":"DOSCC"},{"1":"73.653405","2":"1","3":"9.311107e-18","_rn_":"DOMY"},{"1":"0.228555","2":"1","3":"6.325973e-01","_rn_":"PrevCM"},{"1":"21.176425","2":"12","3":"4.785590e-02","_rn_":"Tx:FARMID"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Significant interaction term.</p>
<p>Descision: Revisit this after covariates are finalized. <br> <br> <br> <br> Tx:DIM category at herd test (P &gt; 0.05)</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx*TestDIMcat20 + Parity + DOSCC + DOMY + PrevCM + (1|FARMID/CowID), data=SDCTCOWDHI)
car::Anova(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"4.9280521","2":"2","3":"8.509168e-02","_rn_":"Tx"},{"1":"1563.6373311","2":"5","3":"0.000000e+00","_rn_":"TestDIMcat20"},{"1":"45.3091157","2":"2","3":"1.449608e-10","_rn_":"Parity"},{"1":"1.8537720","2":"1","3":"1.733453e-01","_rn_":"DOSCC"},{"1":"65.8173203","2":"1","3":"4.947156e-16","_rn_":"DOMY"},{"1":"0.1793358","2":"1","3":"6.719446e-01","_rn_":"PrevCM"},{"1":"11.3951300","2":"10","3":"3.275733e-01","_rn_":"Tx:TestDIMcat20"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> Tx:Parity (P &gt; 0.05)</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx*Parity + TestDIMcat20 + DOSCC + DOMY + PrevCM + (1|FARMID/CowID), data=SDCTCOWDHI)
car::Anova(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"4.9461315","2":"2","3":"8.432594e-02","_rn_":"Tx"},{"1":"45.4963537","2":"2","3":"1.320056e-10","_rn_":"Parity"},{"1":"1563.4543090","2":"5","3":"0.000000e+00","_rn_":"TestDIMcat20"},{"1":"2.2956381","2":"1","3":"1.297379e-01","_rn_":"DOSCC"},{"1":"68.0948176","2":"1","3":"1.558197e-16","_rn_":"DOMY"},{"1":"0.2483234","2":"1","3":"6.182581e-01","_rn_":"PrevCM"},{"1":"6.9869618","2":"4","3":"1.365788e-01","_rn_":"Tx:Parity"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> Tx:PrevCM (P &gt; 0.05)</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx*PrevCM + Parity + TestDIMcat20 + DOSCC + DOMY + (1|FARMID/CowID), data=SDCTCOWDHI)
car::Anova(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"4.9345376","2":"2","3":"8.481619e-02","_rn_":"Tx"},{"1":"0.1708705","2":"1","3":"6.793393e-01","_rn_":"PrevCM"},{"1":"45.4974807","2":"2","3":"1.319312e-10","_rn_":"Parity"},{"1":"1561.6764345","2":"5","3":"0.000000e+00","_rn_":"TestDIMcat20"},{"1":"2.0080546","2":"1","3":"1.564658e-01","_rn_":"DOSCC"},{"1":"67.3721100","2":"1","3":"2.248067e-16","_rn_":"DOMY"},{"1":"1.6370007","2":"2","3":"4.410926e-01","_rn_":"Tx:PrevCM"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br></p>
</div>
<div id="step-5-remove-unnecessary-covariates-using-backwards-selection-10-rule" class="section level3">
<h3>Step 5: Remove unnecessary covariates using backwards selection (10% rule)</h3>
<p>The order for removing covariates will be in increasing likelihood of being a confounder, which is based on my knowledge about the variables and their distribution in treatment groups.</p>
<p>This order will be: DOSCC, PrevCM, Parity, DOMY</p>
<p>TestDIMcat20 will not be removed (forced into model).</p>
<p>Step 5a: Full model</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + PrevCM + Parity + TestDIMcat20 + DOSCC + DOMY + (1|FARMID/CowID), data=SDCTCOWDHI) 
mm0 %&gt;% tidy() %&gt;% subset(select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"30.22473140"},{"1":"TxCulture","2":"-0.04143569"},{"1":"TxAlgorithm","2":"-0.92794949"},{"1":"PrevCM1","2":"-0.24232226"},{"1":"Parity2","2":"2.52548782"},{"1":"Parity3","2":"3.01851112"},{"1":"TestDIMcat2030","2":"11.86182319"},{"1":"TestDIMcat2050","2":"12.87915593"},{"1":"TestDIMcat2070","2":"12.51207701"},{"1":"TestDIMcat2090","2":"11.01315667"},{"1":"TestDIMcat20110","2":"8.43430798"},{"1":"DOSCC","2":"0.26481138"},{"1":"DOMY","2":"0.22068173"},{"1":"sd_(Intercept).CowID:FARMID","2":"5.35709606"},{"1":"sd_(Intercept).FARMID","2":"3.10328465"},{"1":"sd_Observation.Residual","2":"6.79549511"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p><br> <br> <br> <br> Step 5b: Removing DOSCC</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + PrevCM + Parity + TestDIMcat20 + DOMY + (1|FARMID/CowID), data=SDCTCOWDHI) 
mm0 %&gt;% tidy() %&gt;% subset(select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"31.6186799"},{"1":"TxCulture","2":"-0.0454769"},{"1":"TxAlgorithm","2":"-0.9214241"},{"1":"PrevCM1","2":"-0.1178496"},{"1":"Parity2","2":"2.6711615"},{"1":"Parity3","2":"3.2175797"},{"1":"TestDIMcat2030","2":"11.8653493"},{"1":"TestDIMcat2050","2":"12.8776306"},{"1":"TestDIMcat2070","2":"12.5118501"},{"1":"TestDIMcat2090","2":"11.0173053"},{"1":"TestDIMcat20110","2":"8.4342396"},{"1":"DOMY","2":"0.2076918"},{"1":"sd_(Intercept).CowID:FARMID","2":"5.3586475"},{"1":"sd_(Intercept).FARMID","2":"3.1533757"},{"1":"sd_Observation.Residual","2":"6.7958133"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt;10%. DOSCC stays out <br> <br> <br> <br></p>
<p>Step 5c: removing PrevCM</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + Parity + TestDIMcat20 + DOMY + (1|FARMID/CowID), data=SDCTCOWDHI)  
mm0 %&gt;% tidy() %&gt;% subset(select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"31.61485841"},{"1":"TxCulture","2":"-0.04670754"},{"1":"TxAlgorithm","2":"-0.92024861"},{"1":"Parity2","2":"2.66365902"},{"1":"Parity3","2":"3.20325362"},{"1":"TestDIMcat2030","2":"11.86554037"},{"1":"TestDIMcat2050","2":"12.87773056"},{"1":"TestDIMcat2070","2":"12.51167493"},{"1":"TestDIMcat2090","2":"11.01772583"},{"1":"TestDIMcat20110","2":"8.43422993"},{"1":"DOMY","2":"0.20757520"},{"1":"sd_(Intercept).CowID:FARMID","2":"5.35500983"},{"1":"sd_(Intercept).FARMID","2":"3.15319751"},{"1":"sd_Observation.Residual","2":"6.79591757"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &lt; 10%. PrevCM stays out.</p>
<p><br> <br> <br> <br> Step 5d: removing Parity</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + TestDIMcat20 + DOMY + (1|FARMID/CowID), data=SDCTCOWDHI) 
mm0 %&gt;% tidy() %&gt;% subset(select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"33.8573635"},{"1":"TxCulture","2":"-0.1714523"},{"1":"TxAlgorithm","2":"-1.0002069"},{"1":"TestDIMcat2030","2":"11.9101365"},{"1":"TestDIMcat2050","2":"12.8464362"},{"1":"TestDIMcat2070","2":"12.5371850"},{"1":"TestDIMcat2090","2":"10.9906463"},{"1":"TestDIMcat20110","2":"8.4246999"},{"1":"DOMY","2":"0.1879570"},{"1":"sd_(Intercept).CowID:FARMID","2":"5.5602316"},{"1":"sd_(Intercept).FARMID","2":"3.0538164"},{"1":"sd_Observation.Residual","2":"6.7903209"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &gt;10%. Parity stays in. <br> <br> <br></p>
<p>Step 5e: removing DOMY</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + Parity + TestDIMcat20 + (1|FARMID/CowID), data=SDCTCOWDHI) 
mm0 %&gt;% tidy() %&gt;% subset(select=c(term,estimate))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"(Intercept)","2":"37.3558443"},{"1":"TxCulture","2":"0.2007805"},{"1":"TxAlgorithm","2":"-0.8169419"},{"1":"Parity2","2":"2.4166123"},{"1":"Parity3","2":"2.8033774"},{"1":"TestDIMcat2030","2":"11.8422316"},{"1":"TestDIMcat2050","2":"12.8802587"},{"1":"TestDIMcat2070","2":"12.5248245"},{"1":"TestDIMcat2090","2":"10.9596021"},{"1":"TestDIMcat20110","2":"8.4713166"},{"1":"sd_(Intercept).CowID:FARMID","2":"5.5778226"},{"1":"sd_(Intercept).FARMID","2":"3.3379365"},{"1":"sd_Observation.Residual","2":"6.7949203"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Changed by &gt;10%. DOMY stays in. <br> <br> <br> <br></p>
</div>
<div id="revisit-effect-measure-modification-previously-identified" class="section level3">
<h3>Revisit effect measure modification previously identified</h3>
<p>Effect measure modification with herd (P &lt; 0.05)</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx*FARMID + TestDIMcat20 + Parity + DOMY + (1|CowID), data=SDCTCOWDHI)
car::Anova(mm0)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"7.035533","2":"2","3":"2.966562e-02","_rn_":"Tx"},{"1":"409.561141","2":"6","3":"2.458766e-85","_rn_":"FARMID"},{"1":"1502.261245","2":"5","3":"9.387247e-323","_rn_":"TestDIMcat20"},{"1":"70.685740","2":"2","3":"4.474933e-16","_rn_":"Parity"},{"1":"74.558222","2":"1","3":"5.887607e-18","_rn_":"DOMY"},{"1":"21.155292","2":"12","3":"4.815216e-02","_rn_":"Tx:FARMID"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Decision - will investigate effect estimates stratified by herd <br> <br> <br> <br></p>
</div>
<div id="step-6a-final-model-for-milk-yield-1---120-dim-stratified-by-herd." class="section level3">
<h3>Step 6a: Final model for milk yield (1 - 120 DIM), stratified by herd.</h3>
<p>Model output</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx*FARMID + TestDIMcat20 + Parity + DOMY + (1|CowID), data=SDCTCOWDHI)
emmeans(mm0,pairwise ~ Tx | FARMID)</code></pre>
<pre><code>## $emmeans
## FARMID = 1:
##  Tx        emmean    SE  df asymp.LCL asymp.UCL
##  Blanket     47.4 1.240 Inf      45.0      49.8
##  Culture     49.7 1.162 Inf      47.4      51.9
##  Algorithm   46.2 1.381 Inf      43.5      48.9
## 
## FARMID = 2:
##  Tx        emmean    SE  df asymp.LCL asymp.UCL
##  Blanket     49.6 1.200 Inf      47.3      52.0
##  Culture     46.0 1.300 Inf      43.4      48.5
##  Algorithm   43.4 1.188 Inf      41.1      45.8
## 
## FARMID = 3:
##  Tx        emmean    SE  df asymp.LCL asymp.UCL
##  Blanket     43.4 0.703 Inf      42.1      44.8
##  Culture     43.8 0.701 Inf      42.4      45.1
##  Algorithm   42.0 0.736 Inf      40.6      43.5
## 
## FARMID = 4:
##  Tx        emmean    SE  df asymp.LCL asymp.UCL
##  Blanket     53.3 0.565 Inf      52.2      54.4
##  Culture     52.5 0.534 Inf      51.4      53.5
##  Algorithm   53.2 0.558 Inf      52.2      54.3
## 
## FARMID = 5:
##  Tx        emmean    SE  df asymp.LCL asymp.UCL
##  Blanket     49.4 0.739 Inf      48.0      50.9
##  Culture     49.9 0.712 Inf      48.5      51.3
##  Algorithm   48.1 0.752 Inf      46.6      49.5
## 
## FARMID = 6:
##  Tx        emmean    SE  df asymp.LCL asymp.UCL
##  Blanket     49.2 1.515 Inf      46.2      52.1
##  Culture     52.3 1.548 Inf      49.2      55.3
##  Algorithm   50.7 1.698 Inf      47.4      54.1
## 
## FARMID = 7:
##  Tx        emmean    SE  df asymp.LCL asymp.UCL
##  Blanket     50.4 1.014 Inf      48.4      52.4
##  Culture     49.4 1.066 Inf      47.3      51.5
##  Algorithm   49.2 1.067 Inf      47.1      51.2
## 
## Results are averaged over the levels of: TestDIMcat20, Parity 
## Degrees-of-freedom method: asymptotic 
## Confidence level used: 0.95 
## 
## $contrasts
## FARMID = 1:
##  contrast            estimate    SE  df z.ratio p.value
##  Blanket - Culture    -2.2771 1.693 Inf -1.345  0.3704 
##  Blanket - Algorithm   1.1734 1.848 Inf  0.635  0.8008 
##  Culture - Algorithm   3.4506 1.800 Inf  1.917  0.1337 
## 
## FARMID = 2:
##  contrast            estimate    SE  df z.ratio p.value
##  Blanket - Culture     3.6627 1.767 Inf  2.072  0.0956 
##  Blanket - Algorithm   6.2020 1.686 Inf  3.678  0.0007 
##  Culture - Algorithm   2.5393 1.758 Inf  1.444  0.3182 
## 
## FARMID = 3:
##  contrast            estimate    SE  df z.ratio p.value
##  Blanket - Culture    -0.3310 0.990 Inf -0.334  0.9402 
##  Blanket - Algorithm   1.4086 1.015 Inf  1.388  0.3474 
##  Culture - Algorithm   1.7396 1.015 Inf  1.713  0.2002 
## 
## FARMID = 4:
##  contrast            estimate    SE  df z.ratio p.value
##  Blanket - Culture     0.8679 0.770 Inf  1.128  0.4969 
##  Blanket - Algorithm   0.0873 0.786 Inf  0.111  0.9932 
##  Culture - Algorithm  -0.7806 0.760 Inf -1.027  0.5600 
## 
## FARMID = 5:
##  contrast            estimate    SE  df z.ratio p.value
##  Blanket - Culture    -0.5102 0.985 Inf -0.518  0.8627 
##  Blanket - Algorithm   1.3592 1.015 Inf  1.339  0.3733 
##  Culture - Algorithm   1.8695 1.003 Inf  1.863  0.1495 
## 
## FARMID = 6:
##  contrast            estimate    SE  df z.ratio p.value
##  Blanket - Culture    -3.1044 2.164 Inf -1.435  0.3229 
##  Blanket - Algorithm  -1.5474 2.273 Inf -0.681  0.7747 
##  Culture - Algorithm   1.5571 2.290 Inf  0.680  0.7753 
## 
## FARMID = 7:
##  contrast            estimate    SE  df z.ratio p.value
##  Blanket - Culture     0.9515 1.467 Inf  0.649  0.7931 
##  Blanket - Algorithm   1.2379 1.468 Inf  0.843  0.6761 
##  Culture - Algorithm   0.2864 1.503 Inf  0.191  0.9802 
## 
## Results are averaged over the levels of: TestDIMcat20, Parity 
## P value adjustment: tukey method for comparing a family of 3 estimates</code></pre>
<p>It appears that herd 2 (87 cows) and herd 6 (42 cows) have extreme results compared with the other herds. In herd 2, BDCT had much higher MY than SDCT cows. In herd 6, it was the opposite effect. Given these were the smallest herds in the study, I will report a pooled result. <br> <br> <br> <br></p>
</div>
<div id="step-6bi-final-model-reported-without-herd-interaction" class="section level3">
<h3>Step 6bi: Final model reported without herd interaction</h3>
<p>Model output</p>
<pre class="r"><code>summary(lmer(MY ~ Tx + TestDIMcat20 + Parity + DOMY+ (1|FARMID/CowID), data=SDCTCOWDHI))</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: MY ~ Tx + TestDIMcat20 + Parity + DOMY + (1 | FARMID/CowID)
##    Data: SDCTCOWDHI
## 
## REML criterion at convergence: 27949.8
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -6.3374 -0.4572  0.0207  0.5284  3.9942 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev.
##  CowID:FARMID (Intercept) 28.677   5.355   
##  FARMID       (Intercept)  9.946   3.154   
##  Residual                 46.184   6.796   
## Number of obs: 3990, groups:  CowID:FARMID, 1177; FARMID, 7
## 
## Fixed effects:
##                 Estimate Std. Error t value
## (Intercept)     31.61485    1.47112  21.490
## TxCulture       -0.04671    0.46702  -0.100
## TxAlgorithm     -0.92025    0.47129  -1.953
## TestDIMcat2030  11.86555    0.40548  29.263
## TestDIMcat2050  12.87773    0.38856  33.143
## TestDIMcat2070  12.51168    0.38250  32.710
## TestDIMcat2090  11.01773    0.41571  26.503
## TestDIMcat20110  8.43423    0.38402  21.963
## Parity2          2.66366    0.45780   5.818
## Parity3          3.20325    0.47445   6.752
## DOMY             0.20758    0.02539   8.175
## 
## Correlation of Fixed Effects:
##             (Intr) TxCltr TxAlgr TDIM203 TDIM205 TDIM207 TDIM209 TDIM201
## TxCulture   -0.132                                                      
## TxAlgorithm -0.146  0.499                                               
## TstDIMc2030 -0.144 -0.013 -0.012                                        
## TstDIMc2050 -0.132 -0.010 -0.013  0.486                                 
## TstDIMc2070 -0.135 -0.010 -0.004  0.534   0.481                         
## TstDIMc2090 -0.143 -0.005 -0.005  0.515   0.499   0.471                 
## TstDIM20110 -0.129 -0.008 -0.004  0.514   0.507   0.527   0.465         
## Parity2     -0.167  0.055  0.021  0.000   0.008  -0.001   0.004   0.006 
## Parity3     -0.173  0.013  0.018 -0.014   0.009  -0.009   0.012  -0.001 
## DOMY        -0.478 -0.065 -0.027  0.013  -0.002  -0.002   0.019  -0.014 
##             Party2 Party3
## TxCulture                
## TxAlgorithm              
## TstDIMc2030              
## TstDIMc2050              
## TstDIMc2070              
## TstDIMc2090              
## TstDIM20110              
## Parity2                  
## Parity3      0.399       
## DOMY         0.066  0.101</code></pre>
<p>Model output (tidy)</p>
<pre class="r"><code>lmer(MY ~ Tx + TestDIMcat20 + Parity + DOMY + (1|FARMID/CowID), data=SDCTCOWDHI) %&gt;% tidy(conf.int=TRUE)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["term"],"name":[1],"type":["chr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["statistic"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["conf.low"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["conf.high"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"(Intercept)","2":"31.61485444","3":"1.4711168","4":"21.4903771","5":"28.731519","6":"34.498190360","7":"fixed"},{"1":"TxCulture","2":"-0.04670732","3":"0.4670237","4":"-0.1000106","5":"-0.962057","6":"0.868642401","7":"fixed"},{"1":"TxAlgorithm","2":"-0.92024803","3":"0.4712865","4":"-1.9526296","5":"-1.843953","6":"0.003456588","7":"fixed"},{"1":"TestDIMcat2030","2":"11.86555044","3":"0.4054838","4":"29.2627006","5":"11.070817","6":"12.660284041","7":"fixed"},{"1":"TestDIMcat2050","2":"12.87772927","3":"0.3885556","4":"33.1425628","5":"12.116174","6":"13.639284302","7":"fixed"},{"1":"TestDIMcat2070","2":"12.51167997","3":"0.3825022","4":"32.7100850","5":"11.761989","6":"13.261370534","7":"fixed"},{"1":"TestDIMcat2090","2":"11.01772892","3":"0.4157131","4":"26.5032046","5":"10.202946","6":"11.832511596","7":"fixed"},{"1":"TestDIMcat20110","2":"8.43422830","3":"0.3840239","4":"21.9627719","5":"7.681555","6":"9.186901225","7":"fixed"},{"1":"Parity2","2":"2.66366126","3":"0.4578003","4":"5.8183909","5":"1.766389","6":"3.560933425","7":"fixed"},{"1":"Parity3","2":"3.20325176","3":"0.4744453","4":"6.7515723","5":"2.273356","6":"4.133147456","7":"fixed"},{"1":"DOMY","2":"0.20757511","3":"0.0253903","4":"8.1753719","5":"0.157811","6":"0.257339174","7":"fixed"},{"1":"sd_(Intercept).CowID:FARMID","2":"5.35510819","3":"NA","4":"NA","5":"NA","6":"NA","7":"CowID:FARMID"},{"1":"sd_(Intercept).FARMID","2":"3.15367925","3":"NA","4":"NA","5":"NA","6":"NA","7":"FARMID"},{"1":"sd_Observation.Residual","2":"6.79588532","3":"NA","4":"NA","5":"NA","6":"NA","7":"Residual"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="icc-for-my-1---120-dim" class="section level4">
<h4>ICC for MY (1 - 120 DIM)</h4>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ 1 + (1|FARMID/CowID), data=SDCTCOWDHI)
summary(mm0)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: MY ~ 1 + (1 | FARMID/CowID)
##    Data: SDCTCOWDHI
## 
## REML criterion at convergence: 29310.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -5.1211 -0.4867  0.0849  0.5681  3.5617 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev.
##  CowID:FARMID (Intercept) 27.03    5.199   
##  FARMID       (Intercept) 10.06    3.172   
##  Residual                 70.88    8.419   
## Number of obs: 3990, groups:  CowID:FARMID, 1177; FARMID, 7
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   48.286      1.226   39.38</code></pre>
<p>ICC (CowID) = 0.25 ICC (FARMID) = 0.09</p>
<p>Emmeans without TestDIM interaction</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + TestDIMcat20 + Parity + DOMY+ (1|FARMID/CowID), data=SDCTCOWDHI)

emmeans(mm0,~Tx) %&gt;% tidy</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Tx"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["estimate"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["std.error"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["asymp.LCL"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["asymp.UCL"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"Blanket","2":"48.74105","3":"1.245921","4":"Inf","5":"46.29909","6":"51.18301"},{"1":"Culture","2":"48.69434","3":"1.246204","4":"Inf","5":"46.25182","6":"51.13685"},{"1":"Algorithm","2":"47.82080","3":"1.248082","4":"Inf","5":"45.37460","6":"50.26699"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div id="step-6bii-final-model-reported-without-herd-interaction-using-p-value-based-backwards-elimination" class="section level3">
<h3>Step 6bii: Final model reported without herd interaction (using P-value based backwards elimination)</h3>
<p>Model output</p>
<pre class="r"><code>summary(lmer(MY ~ Tx + TestDIMcat20 + Parity + (1|FARMID/CowID), data=SDCTCOWDHI))</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: MY ~ Tx + TestDIMcat20 + Parity + (1 | FARMID/CowID)
##    Data: SDCTCOWDHI
## 
## REML criterion at convergence: 28009.3
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -6.2353 -0.4645  0.0246  0.5246  3.9839 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev.
##  CowID:FARMID (Intercept) 31.11    5.578   
##  FARMID       (Intercept) 11.14    3.338   
##  Residual                 46.17    6.795   
## Number of obs: 3990, groups:  CowID:FARMID, 1177; FARMID, 7
## 
## Fixed effects:
##                 Estimate Std. Error t value
## (Intercept)      37.3558     1.3606  27.456
## TxCulture         0.2008     0.4792   0.419
## TxAlgorithm      -0.8169     0.4844  -1.687
## TestDIMcat2030   11.8422     0.4064  29.139
## TestDIMcat2050   12.8803     0.3890  33.113
## TestDIMcat2070   12.5248     0.3830  32.704
## TestDIMcat2090   10.9596     0.4165  26.315
## TestDIMcat20110   8.4713     0.3844  22.040
## Parity2           2.4166     0.4697   5.145
## Parity3           2.8034     0.4853   5.777
## 
## Correlation of Fixed Effects:
##             (Intr) TxCltr TxAlgr TDIM203 TDIM205 TDIM207 TDIM209 TDIM201
## TxCulture   -0.182                                                      
## TxAlgorithm -0.177  0.499                                               
## TstDIMc2030 -0.150 -0.012 -0.012                                        
## TstDIMc2050 -0.144 -0.010 -0.013  0.486                                 
## TstDIMc2070 -0.147 -0.010 -0.004  0.535   0.480                         
## TstDIMc2090 -0.145 -0.004 -0.005  0.515   0.499   0.470                 
## TstDIM20110 -0.147 -0.009 -0.005  0.515   0.507   0.528   0.464         
## Parity2     -0.151  0.059  0.022 -0.001   0.008  -0.001   0.003   0.006 
## Parity3     -0.139  0.019  0.021 -0.015   0.009  -0.008   0.010   0.000 
##             Party2
## TxCulture         
## TxAlgorithm       
## TstDIMc2030       
## TstDIMc2050       
## TstDIMc2070       
## TstDIMc2090       
## TstDIM20110       
## Parity2           
## Parity3      0.395</code></pre>
<p><br> <br> <br> <br></p>
</div>
<div id="step-6biii-final-model-using-10-rule-reported-as-estimated-marginal-means-by-test-dim-category-no-interaction-with-test-dim" class="section level3">
<h3>Step 6biii: Final model (using 10% rule) reported as estimated marginal means by test DIM category (no interaction with test DIM)</h3>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + TestDIMcat20 + Parity + DOMY + (1|FARMID/CowID), data=SDCTCOWDHI)

atx &lt;- c(10,30,50,70,90,110)
emm &lt;- emmeans(mm0, ~Tx*TestDIMcat20) %&gt;% tidy()
emm$MY &lt;- emm$estimate
emm$LCL &lt;- emm$asymp.LCL
emm$UCL &lt;- emm$asymp.UCL
emm %&gt;% subset(select=c(Tx,TestDIMcat20,MY,LCL,UCL))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Tx"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["TestDIMcat20"],"name":[2],"type":["fctr"],"align":["left"]},{"label":["MY"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["LCL"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["UCL"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"Blanket","2":"10","3":"39.28989","4":"36.79678","5":"41.78300"},{"1":"Culture","2":"10","3":"39.24319","4":"36.74735","5":"41.73902"},{"1":"Algorithm","2":"10","3":"38.36965","4":"35.87052","5":"40.86877"},{"1":"Blanket","2":"30","3":"51.15544","4":"48.66411","5":"53.64677"},{"1":"Culture","2":"30","3":"51.10874","4":"48.61860","5":"53.59887"},{"1":"Algorithm","2":"30","3":"50.23520","4":"47.74140","5":"52.72900"},{"1":"Blanket","2":"50","3":"52.16762","4":"49.67369","5":"54.66156"},{"1":"Culture","2":"50","3":"52.12092","4":"49.62699","5":"54.61484"},{"1":"Algorithm","2":"50","3":"51.24737","4":"48.75109","5":"53.74366"},{"1":"Blanket","2":"70","3":"51.80157","4":"49.31404","5":"54.28911"},{"1":"Culture","2":"70","3":"51.75487","4":"49.26724","5":"54.24249"},{"1":"Algorithm","2":"70","3":"50.88133","4":"48.38889","5":"53.37376"},{"1":"Blanket","2":"90","3":"50.30762","4":"47.80605","5":"52.80919"},{"1":"Culture","2":"90","3":"50.26092","4":"47.75813","5":"52.76370"},{"1":"Algorithm","2":"90","3":"49.38737","4":"46.88144","5":"51.89331"},{"1":"Blanket","2":"110","3":"47.72412","4":"45.23509","5":"50.21315"},{"1":"Culture","2":"110","3":"47.67741","4":"45.18795","5":"50.16687"},{"1":"Algorithm","2":"110","3":"46.80387","4":"44.31005","5":"49.29770"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Plotting model as predicted values</p>
<pre class="r"><code>curve &lt;- ggplot(emm) + coord_cartesian(ylim = (c(0,55))) + aes(x=TestDIMcat20, y=MY, group=Tx, colour=Tx) + geom_point() + geom_line(aes(colour=Tx,linetype=Tx)) + geom_ribbon(aes(ymin=emm$LCL, ymax=emm$UCL,colour=Tx,fill=Tx), linetype=0, alpha=0.1)
curve</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-107-1.png" width="672" /> <br> <br> <br> <br> Reported as estimated marginal means by test day category with interaction with herd test DIM</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx*TestDIMcat20 + Parity + DOMY + (1|FARMID/CowID), data=SDCTCOWDHI)
atx &lt;- c(10,30,50,70,90,110)
emm &lt;- emmeans(mm0, ~Tx*TestDIMcat20, at=list(atx)) %&gt;% tidy()
emm$MY &lt;- emm$estimate
emm$LCL &lt;- emm$asymp.LCL
emm$UCL &lt;- emm$asymp.UCL
emm &lt;- emm %&gt;% subset(select=c(Tx,TestDIMcat20,MY,LCL,UCL))

curve &lt;- ggplot(emm) + coord_cartesian(ylim = (c(0,55))) + aes(x=TestDIMcat20, y=MY, group=Tx, colour=Tx) + geom_point() + geom_line(aes(colour=Tx,linetype=Tx)) + geom_ribbon(aes(ymin=emm$LCL, ymax=emm$UCL,colour=Tx,fill=Tx), linetype=0, alpha=0.1)
curve</code></pre>
<p><img src="Journal_files/figure-html/emmeans-1.png" width="672" /></p>
</div>
<div id="step-7-model-diagnostics-1" class="section level3">
<h3>Step 7: Model diagnostics</h3>
<p>Checking homoskedasticity assumption (variance of residuals)</p>
<pre class="r"><code>mm0 &lt;- lmer(MY ~ Tx + TestDIMcat20 + Parity +DOMY+ (1|FARMID/CowID), data=SDCTCOWDHI)
ggplot(data.frame(eta=predict(mm0,type=&quot;link&quot;),pearson=residuals(mm0,type=&quot;pearson&quot;)),
       aes(x=eta,y=pearson)) +
  geom_point() +
  theme_bw()</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-108-1.png" width="672" /></p>
<p>Checking normality of residuals</p>
<pre class="r"><code>qqnorm(residuals(mm0))</code></pre>
<p><img src="Journal_files/figure-html/unnamed-chunk-109-1.png" width="672" /></p>
<p>I am happy with homoskedasticity and normal residuals assumptions</p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
